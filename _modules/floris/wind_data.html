
<!DOCTYPE html>


<html lang="python" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>floris.wind_data &#8212; FLORIS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=30a733bc"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-JV2SK7CNPR"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-JV2SK7CNPR');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-JV2SK7CNPR');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@10.8/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10.8/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10.8/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/floris/wind_data';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="python"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/docs_image.png" class="logo__image only-light" alt="FLORIS - Home"/>
    <script>document.write(`<img src="../../_static/docs_image.png" class="logo__image only-dark" alt="FLORIS - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    FLORIS Wake Modeling & Wind Farm Controls
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../v3_to_v4.html">Switching from FLORIS v3 to v4</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../intro_concepts.html">Introductory Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wind_data_user.html">Wind Data Objects</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../floris_models.html">FLORIS Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced_concepts.html">Advanced Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../heterogeneous_map.html">Heterogeneous Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../floating_wind_turbine.html">Floating Wind Turbine Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../turbine_interaction.html">Turbine Library Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operation_models_user.html">Turbine Operation Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout_optimization.html">Layout Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input_reference_main.html">Main Input File Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input_reference_turbine.html">Turbine Input File Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory and Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../wake_models.html">Wake Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../empirical_gauss_model.html">Empirical Gaussian model</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide.html">Developer's Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_quality.html">Code Quality</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api_docs.html">API Documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.flow_visualization.html">floris.flow_visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.floris_model.html">floris.floris_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.wind_data.html">floris.wind_data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.uncertain_floris_model.html">floris.uncertain_floris_model</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/floris.turbine_library.html">floris.turbine_library</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.turbine_library.turbine_previewer.html">floris.turbine_library.turbine_previewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.turbine_library.turbine_utilities.html">floris.turbine_library.turbine_utilities</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.parallel_floris_model.html">floris.parallel_floris_model</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/floris.optimization.html">floris.optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.html">floris.optimization.layout_optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_base.html">floris.optimization.layout_optimization.layout_optimization_base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_boundary_grid.html">floris.optimization.layout_optimization.layout_optimization_boundary_grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_gridded.html">floris.optimization.layout_optimization.layout_optimization_gridded</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_pyoptsparse.html">floris.optimization.layout_optimization.layout_optimization_pyoptsparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_pyoptsparse_spread.html">floris.optimization.layout_optimization.layout_optimization_pyoptsparse_spread</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_random_search.html">floris.optimization.layout_optimization.layout_optimization_random_search</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.layout_optimization.layout_optimization_scipy.html">floris.optimization.layout_optimization.layout_optimization_scipy</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.optimization.load_optimization.html">floris.optimization.load_optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.load_optimization.load_optimization.html">floris.optimization.load_optimization.load_optimization</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.optimization.other.html">floris.optimization.other</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.other.boundary_grid.html">floris.optimization.other.boundary_grid</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.html">floris.optimization.yaw_optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.yaw_optimization_base.html">floris.optimization.yaw_optimization.yaw_optimization_base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.yaw_optimization_tools.html">floris.optimization.yaw_optimization.yaw_optimization_tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.yaw_optimizer_geometric.html">floris.optimization.yaw_optimization.yaw_optimizer_geometric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.yaw_optimizer_scipy.html">floris.optimization.yaw_optimization.yaw_optimizer_scipy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.optimization.yaw_optimization.yaw_optimizer_sr.html">floris.optimization.yaw_optimization.yaw_optimizer_sr</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.layout_visualization.html">floris.layout_visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.cut_plane.html">floris.cut_plane</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/floris.core.html">floris.core</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.base.html">floris.core.base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.core.html">floris.core.core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.farm.html">floris.core.farm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.flow_field.html">floris.core.flow_field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.grid.html">floris.core.grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.rotor_velocity.html">floris.core.rotor_velocity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.solver.html">floris.core.solver</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.core.turbine.html">floris.core.turbine</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.turbine.controller_dependent_operation_model.html">floris.core.turbine.controller_dependent_operation_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.turbine.operation_models.html">floris.core.turbine.operation_models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.turbine.turbine.html">floris.core.turbine.turbine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.turbine.unified_momentum_model.html">floris.core.turbine.unified_momentum_model</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/floris.core.wake.html">floris.core.wake</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.core.wake_combination.html">floris.core.wake_combination</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_combination.fls.html">floris.core.wake_combination.fls</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_combination.max.html">floris.core.wake_combination.max</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_combination.sosfs.html">floris.core.wake_combination.sosfs</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.core.wake_deflection.html">floris.core.wake_deflection</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_deflection.empirical_gauss.html">floris.core.wake_deflection.empirical_gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_deflection.gauss.html">floris.core.wake_deflection.gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_deflection.jimenez.html">floris.core.wake_deflection.jimenez</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_deflection.none.html">floris.core.wake_deflection.none</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.core.wake_turbulence.html">floris.core.wake_turbulence</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_turbulence.crespo_hernandez.html">floris.core.wake_turbulence.crespo_hernandez</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_turbulence.none.html">floris.core.wake_turbulence.none</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_turbulence.wake_induced_mixing.html">floris.core.wake_turbulence.wake_induced_mixing</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.html">floris.core.wake_velocity</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.cumulative_gauss_curl.html">floris.core.wake_velocity.cumulative_gauss_curl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.empirical_gauss.html">floris.core.wake_velocity.empirical_gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.gauss.html">floris.core.wake_velocity.gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.jensen.html">floris.core.wake_velocity.jensen</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.none.html">floris.core.wake_velocity.none</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.turbopark.html">floris.core.wake_velocity.turbopark</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/floris.core.wake_velocity.turboparkgauss.html">floris.core.wake_velocity.turboparkgauss</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.convert_turbine_v3_to_v4.html">floris.convert_turbine_v3_to_v4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.convert_floris_input_v3_to_v4.html">floris.convert_floris_input_v3_to_v4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.utilities.html">floris.utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.type_dec.html">floris.type_dec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/floris.logging_manager.html">floris.logging_manager</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/001_opening_floris_computing_power.html">Example 1: Opening FLORIS and Computing Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/002_visualizations.html">Example 2: Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/003_wind_data_objects.html">Example 3: Wind Data Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/004_set.html">Example 4: Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/005_getting_power.html">Example 5: Getting Turbine and Farm Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/006_get_farm_aep.html">Example 6: Getting Expected Power and AEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/007_sweeping_variables.html">Example 7: Sweeping Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/008_uncertain_models.html">Example 8: Uncertain Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/009_parallel_models.html">Example 9: Parallel Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/010_compare_farm_power_with_neighbor.html">Example 10: Compare farm power with neighboring farm</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Control optimization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/001_opt_yaw_single_ws.html">Example: Optimize yaw for a single wind speed and multiple wind directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/002_opt_yaw_single_ws_uncertain.html">Example: Optimize yaw for a single wind speed and multiple wind directions.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/003_opt_yaw_multiple_ws.html">Example: Optimize yaw for multiple wind directions and multiple wind speeds.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/004_optimize_yaw_aep.html">Example: Optimize yaw and compare AEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/005_optimize_yaw_aep_parallel.html">Example: Optimize yaw and compare AEP in parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/006_compare_yaw_optimizers.html">Example: Compare yaw optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/007_optimize_yaw_with_neighbor_farms.html">Example: Optimize yaw with neighbor farm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_optimization/008_optimize_yaw_with_disabled_turbines.html">Example: Optimizing yaw angles with disabled turbines</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Control types</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_types/001_derating_control.html">Example of using the simple-derating control model in FLORIS.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_types/002_disable_turbines.html">Example: Disabling turbines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_types/003_setting_yaw_and_disabling.html">Example: Setting yaw angles and disabling turbine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_types/004_helix_active_wake_mixing.html">Example: Helix active wake mixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_control_types/005_peak_shaving.html">Example of using the peak-shaving turbine operation model.</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Emgauss</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_emgauss/001_empirical_gauss_velocity_deficit_parameters.html">Example: Empirical Gaussian velocity deficit parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_emgauss/002_empirical_gauss_deflection_parameters.html">Example: Empirical Gaussian deflection parameters</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Floating</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_floating/001_floating_turbine_models.html">Example: Floating turbines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_floating/002_floating_vs_fixedbottom_farm.html">Example: Floating vs fixed-bottom farm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_floating/003_tilt_driven_vertical_wake_deflection.html">Example: Tilt-driven vertical wake deflection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Get flow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_get_flow/001_extract_wind_speed_at_turbines.html">Example: Extract wind speed at turbines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_get_flow/002_extract_wind_speed_at_points.html">Example: Extract wind speed at points</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_get_flow/003_plot_velocity_deficit_profiles.html">Example: Plot velocity deficit profiles</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Heterogeneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_heterogeneous/001_heterogeneous_inflow_single.html">Example: Heterogeneous Inflow for single case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_heterogeneous/002_heterogeneous_using_wind_data.html">Example: Heterogeneous Inflow using wind data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_heterogeneous/003_heterogeneous_speedup_by_wd_and_ws.html">Example: Heterogeneous Speedup by Wind Direction and Wind Speed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_heterogeneous/004_heterogeneous_2d_and_3d.html">Example: Heterogeneous Inflow in 2D and 3D</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Layout optimization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_layout_optimization/001_optimize_layout.html">Example: Optimize Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_layout_optimization/002_optimize_layout_with_heterogeneity.html">Example: Layout optimization with heterogeneous inflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_layout_optimization/003_genetic_random_search.html">Example: Layout optimization with genetic random search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_layout_optimization/004_generate_gridded_layout.html">Example: Gridded layout design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_layout_optimization/005_layout_optimization_complex_boundary.html">Example: Separated boundaries layout optimization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Load optimization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_load_optimization/001_lti_and_voc.html">Example: LTI and VOC Behavior with Changing Wind Direction and Power Setpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_load_optimization/002_row_opt_example.html">Example: Optimize a row of turbines</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Multidim</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_multidim/001_multi_dimensional_cp_ct.html">Example: Multi-dimensional Cp/Ct data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_multidim/002_multi_dimensional_cp_ct_2Hs.html">Example: Multi-dimensional Cp/Ct with 2 Hs values</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Operation models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_operation_models/001_compare_yaw_loss.html">Example: Compare yaw loss under different operation models</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Turbine</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_turbine/001_check_turbine.html">Example: Check turbine power curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_turbine/002_multiple_turbine_types.html">Example: Multiple turbine types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_turbine/003_specify_turbine_power_curve.html">Example: Specify turbine power curve</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Turbopark</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_turbopark/001_compare_turbopark_implementations.html">Example: Compare TurbOPark model implementations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Uncertain</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_uncertain/001_uncertain_model_params.html">Example: Uncertain Model Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_uncertain/002_approx_floris_model.html">Example: Approximate Model Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_uncertain/003_uncertain_model_with_parallelization.html">Example: Uncertain Model With Parallelization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Visualizations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_visualizations/001_layout_visualizations.html">Example: Layout Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_visualizations/002_visualize_y_cut_plane.html">Example: Visualize y cut plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_visualizations/003_visualize_cross_plane.html">Example: Visualize cross plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_visualizations/004_visualize_rotor_values.html">Example: Visualize rotor velocities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_visualizations/005_visualize_flow_by_sweeping_turbines.html">Example: Visualize flow by sweeping turbines</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Wind data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_data/001_wind_data_comparisons.html">Example: Wind Data Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_data/002_generate_ti.html">Example: Generate TI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_data/003_generate_value.html">Example: Generate value</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples - Wind resource grid</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_resource_grid/000_generate_example_wrg.html">Example: Generate Example WRG File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_resource_grid/001_wind_rose_wrg.html">Example: WindRoseWRG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_resource_grid/002_set_floris_with_wrg.html">Example: Setting FLORIS with WindRoseWRG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_wind_resource_grid/003_wrg_compar_layout_optimization.html">Example: Layout optimization with WindRoseWRG comparison</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NREL/floris" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NREL/floris/issues/new?title=Issue%20on%20page%20%2F_modules/floris/wind_data.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for floris.wind_data</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">CategoricalDtype</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LinearNDInterpolator</span><span class="p">,</span>
    <span class="n">NearestNDInterpolator</span><span class="p">,</span>
    <span class="n">RegularGridInterpolator</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">floris.heterogeneous_map</span><span class="w"> </span><span class="kn">import</span> <span class="n">HeterogeneousMap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">floris.type_dec</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArrayFloat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">floris.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_and_identify_step_size</span><span class="p">,</span>
    <span class="n">make_wind_directions_adjacent</span><span class="p">,</span>
    <span class="n">wrap_180</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="WindDataBase">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WindDataBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Super class that WindRose and TimeSeries inherit from, enforcing the implementation of</span>
<span class="sd">    unpack() on the child classes and providing the general functions unpack_for_reinitialize() and</span>
<span class="sd">    unpack_freq().</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WindDataBase.unpack">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.unpack">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Placeholder for child classes of WindDataBase, which each need to implement the unpack()</span>
<span class="sd">        method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;unpack() not implemented on </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span></div>


<div class="viewcode-block" id="WindDataBase.unpack_for_reinitialize">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.unpack_for_reinitialize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack_for_reinitialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return only the variables need for FlorisModel.reinitialize</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">wind_directions_unpack</span><span class="p">,</span>
            <span class="n">wind_speeds_unpack</span><span class="p">,</span>
            <span class="n">ti_table_unpack</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">wind_directions_unpack</span><span class="p">,</span>
            <span class="n">wind_speeds_unpack</span><span class="p">,</span>
            <span class="n">ti_table_unpack</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WindDataBase.unpack_freq">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.unpack_freq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack frequency weighting&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span></div>


<div class="viewcode-block" id="WindDataBase.unpack_value">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.unpack_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack values of power generated&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span></div>


<div class="viewcode-block" id="WindDataBase.check_heterogeneous_inflow_config">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.check_heterogeneous_inflow_config">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_heterogeneous_inflow_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heterogeneous_inflow_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that the heterogeneous_inflow_config dictionary is properly formatted</span>

<span class="sd">        Args:</span>
<span class="sd">            heterogeneous_inflow_config (dict): A dictionary containing the following keys:</span>
<span class="sd">                * &#39;speed_multipliers&#39;: A 2D NumPy array (size n_findex x num_points)</span>
<span class="sd">                      of speed multipliers.</span>
<span class="sd">                * &#39;x&#39;: A 1D NumPy array (size num_points) of x-coordinates (meters).</span>
<span class="sd">                * &#39;y&#39;: A 1D NumPy array (size num_points) of y-coordinates (meters).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">heterogeneous_inflow_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_inflow_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;heterogeneous_inflow_config_by_wd must be a dictionary&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;speed_multipliers&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">heterogeneous_inflow_config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;heterogeneous_inflow_config must contain a key &#39;speed_multipliers&#39;&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;x&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">heterogeneous_inflow_config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;heterogeneous_inflow_config must contain a key &#39;x&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;y&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">heterogeneous_inflow_config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;heterogeneous_inflow_config must contain a key &#39;y&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindDataBase.set_layout">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindDataBase.set_layout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default implementation the explicitly does nothing.  Only WindData objects that depend</span>
<span class="sd">        on layout need to implement this method.</span>

<span class="sd">        Included so that FlorisModel can call this method on the WindData object when the layout</span>
<span class="sd">        is updated.</span>

<span class="sd">        Args:</span>
<span class="sd">            layout_x (list, optional): List of x-coordinates of the turbines. Defaults to None.</span>
<span class="sd">            layout_y (list, optional): List of y-coordinates of the turbines. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># No operation performed</span>
        <span class="k">return</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="WindRose">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WindRose</span><span class="p">(</span><span class="n">WindDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The WindRose class is used to drive FLORIS and optimization operations in</span>
<span class="sd">    which the inflow is characterized by the frequency of binned wind speed and</span>
<span class="sd">    wind direction values.  Turbulence intensities are defined as a function of</span>
<span class="sd">    wind direction and wind speed.</span>

<span class="sd">    Args:</span>
<span class="sd">        wind_directions: NumPy array of wind directions (NDArrayFloat).  Must</span>
<span class="sd">            be evenly spaced and monotonically increasing.</span>
<span class="sd">        wind_speeds: NumPy array of wind speeds (NDArrayFloat).  Must be</span>
<span class="sd">            evenly spaced and monotonically increasing.</span>
<span class="sd">        ti_table: Turbulence intensity table for binned wind direction, wind</span>
<span class="sd">            speed values (float, NDArrayFloat).  Can be an array with dimensions</span>
<span class="sd">            (n_wind_directions, n_wind_speeds) or a single float value.  If a</span>
<span class="sd">            single float value is provided, the turbulence intensity is assumed</span>
<span class="sd">            to be constant across all wind directions and wind speeds.</span>
<span class="sd">        freq_table: Frequency table for binned wind direction, wind speed</span>
<span class="sd">            values (NDArrayFloat, optional).   Must have dimension</span>
<span class="sd">            (n_wind_directions, n_wind_speeds).  Defaults to None in which case</span>
<span class="sd">            uniform frequency of all bins is assumed.</span>
<span class="sd">        value_table: Value table for binned wind direction, wind</span>
<span class="sd">            speed values (NDArrayFloat, optional).  Must have dimension</span>
<span class="sd">            (n_wind_directions, n_wind_speeds).  Defaults to None in which case</span>
<span class="sd">            uniform values are assumed.  Value can be used to weight power in</span>
<span class="sd">            each bin to compute the total value of the energy produced</span>
<span class="sd">        compute_zero_freq_occurrence: Flag indicating whether to compute zero</span>
<span class="sd">            frequency occurrences (bool, optional).  Defaults to False.</span>
<span class="sd">        heterogeneous_map (HeterogeneousMap, optional): A HeterogeneousMap object to define</span>
<span class="sd">            background heterogeneous inflow condition as a function</span>
<span class="sd">            of wind direction and wind speed.  Alternatively, a dictionary can be</span>
<span class="sd">            passed in to define a HeterogeneousMap object.  Defaults to None.</span>
<span class="sd">        heterogeneous_inflow_config_by_wd (dict, optional): A dictionary containing the following</span>
<span class="sd">            which can be used to define a heterogeneous_map object (note this parameter is kept</span>
<span class="sd">            for backwards compatibility and is not recommended for use):</span>
<span class="sd">            * &#39;x&#39;: A 1D NumPy array (size num_points) of x-coordinates (meters).</span>
<span class="sd">            * &#39;y&#39;: A 1D NumPy array (size num_points) of y-coordinates (meters).</span>
<span class="sd">            * &#39;speed_multipliers&#39;: A 2D NumPy array (size num_wd (or num_ws) x num_points)</span>
<span class="sd">                of speed multipliers.  If neither wind_directions nor wind_speeds are</span>
<span class="sd">                defined, then this should be a single row array</span>
<span class="sd">            * &#39;wind_directions&#39;: A 1D NumPy array (size num_wd) of wind directions (degrees).</span>
<span class="sd">                Optional.</span>
<span class="sd">            * &#39;wind_speeds&#39;: A 1D NumPy array (size num_ws) of wind speeds (m/s). Optional.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wind_directions</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">wind_speeds</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">ti_table</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">freq_table</span><span class="p">:</span> <span class="n">NDArrayFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value_table</span><span class="p">:</span> <span class="n">NDArrayFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compute_zero_freq_occurrence</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">heterogeneous_map</span><span class="p">:</span> <span class="n">HeterogeneousMap</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_directions must be a NumPy array&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be a NumPy array&quot;</span><span class="p">)</span>

        <span class="c1"># Confirm that both wind_directions and wind_speeds are monitonically</span>
        <span class="c1"># increasing and evenly spaced</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check monotonically increasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_directions must be monotonically increasing&quot;</span><span class="p">)</span>

            <span class="c1"># Check evenly spaced (Function will raise error if not)</span>
            <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="n">wind_directions</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check monotonically increasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be monotonically increasing&quot;</span><span class="p">)</span>

            <span class="c1"># Check evenly spaced</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">),</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be evenly spaced&quot;</span><span class="p">)</span>

        <span class="c1"># Save the wind speeds and directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="n">wind_directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds</span>

        <span class="c1"># Check ti_table is a float or a NumPy array</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ti_table</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ti_table must be a float or a NumPy array&quot;</span><span class="p">)</span>

        <span class="c1"># Check if ti_table is a single float value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ti_table</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)),</span> <span class="n">ti_table</span><span class="p">)</span>

        <span class="c1"># Otherwise confirm the dimensions and then save it</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ti_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ti_table first dimension must equal len(wind_directions)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ti_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ti_table second dimension must equal len(wind_speeds)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span> <span class="o">=</span> <span class="n">ti_table</span>

        <span class="c1"># If freq_table is not None, confirm it has correct dimension,</span>
        <span class="c1"># otherwise initialize to uniform probability</span>
        <span class="k">if</span> <span class="n">freq_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_table first dimension must equal len(wind_directions)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_table second dimension must equal len(wind_speeds)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)))</span>

        <span class="c1"># Normalize freq table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="p">)</span>

        <span class="c1"># If value_table is not None, confirm it has correct dimension,</span>
        <span class="c1"># otherwise initialize to all ones</span>
        <span class="k">if</span> <span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value_table first dimension must equal len(wind_directions)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value_table second dimension must equal len(wind_speeds)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">=</span> <span class="n">value_table</span>

        <span class="c1"># Save whether zero occurrence cases should be computed</span>
        <span class="c1"># First check if the ti_table contains any nan values (which would occur for example</span>
        <span class="c1"># if generated by the TimeSeries to WindRose conversion for wind speeds and directions</span>
        <span class="c1"># that were not present in the original time series)  In this case, raise an error</span>
        <span class="k">if</span> <span class="n">compute_zero_freq_occurrence</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;ti_table contains nan values.  (This is likely the result of &quot;</span>
                    <span class="s2">&quot; unsed wind speeds and directions in the original time series.)&quot;</span>
                    <span class="s2">&quot;  Cannot compute zero frequency occurrences.&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span> <span class="o">=</span> <span class="n">compute_zero_freq_occurrence</span>

        <span class="c1"># Check that heterogeneous_map and heterogeneous_inflow_config_by_wd are not both defined</span>
        <span class="k">if</span> <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of heterogeneous_map and heterogeneous_inflow_config_by_wd can be&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; defined.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If heterogeneous_inflow_config_by_wd is not None, then create a HeterogeneousMap object</span>
        <span class="c1"># using the dictionary</span>
        <span class="k">if</span> <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: In future, add deprecation warning for this parameter here</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">)</span>

        <span class="c1"># Else if heterogeneous_map is not None</span>
        <span class="k">elif</span> <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If heterogeneous_map is a dictionary, then create a HeterogeneousMap object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_map</span><span class="p">)</span>

            <span class="c1"># Else if heterogeneous_map is a HeterogeneousMap object, then save it</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="n">HeterogeneousMap</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">heterogeneous_map</span>

            <span class="c1"># Else raise an error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;heterogeneous_map must be a HeterogeneousMap object or a dictionary.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Else if neither heterogeneous_map nor heterogeneous_inflow_config_by_wd are defined,</span>
        <span class="c1"># then set heterogeneous_map to None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Build the gridded and flatten versions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_gridded_and_flattened_version</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_gridded_and_flattened_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the wind direction and speed array, build the gridded versions</span>
<span class="sd">        covering all combinations, and then flatten versions which put all</span>
<span class="sd">        combinations into 1D array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Gridded wind speed and direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Flat wind speed and direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Flat frequency table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Flat TI table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ti_table_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># value table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set mask to non-zero frequency cases depending on compute_zero_freq_occurrence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">:</span>
            <span class="c1"># If computing zero freq occurrences, then this is all True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

        <span class="c1"># N_findex should only be the calculated cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_findex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">)</span>

<div class="viewcode-block" id="WindRose.unpack">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.unpack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack the flattened versions of the matrices and return the values</span>
<span class="sd">        accounting for the non_zero_freq_mask</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The unpacked versions start as the flat version of each</span>
        <span class="n">wind_directions_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wind_speeds_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq_table_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ti_table_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_table_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Now mask thes values according to self.non_zero_freq_mask</span>
        <span class="n">wind_directions_unpack</span> <span class="o">=</span> <span class="n">wind_directions_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">wind_speeds_unpack</span> <span class="o">=</span> <span class="n">wind_speeds_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">freq_table_unpack</span> <span class="o">=</span> <span class="n">freq_table_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">ti_table_unpack</span> <span class="o">=</span> <span class="n">ti_table_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>

        <span class="c1"># Now get unpacked value table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_table_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_table_unpack</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If heterogeneous_map is not None, then get the heterogeneous_inflow_config</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="o">.</span><span class="n">get_heterogeneous_inflow_config</span><span class="p">(</span>
                <span class="n">wind_directions</span><span class="o">=</span><span class="n">wind_directions_unpack</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds_unpack</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">wind_directions_unpack</span><span class="p">,</span>
            <span class="n">wind_speeds_unpack</span><span class="p">,</span>
            <span class="n">ti_table_unpack</span><span class="p">,</span>
            <span class="n">freq_table_unpack</span><span class="p">,</span>
            <span class="n">value_table_unpack</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.aggregate">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.aggregate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for downsample method for backwards compatibility</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">inplace</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.downsample">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.downsample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregates the wind rose into fewer wind direction and wind speed bins.</span>
<span class="sd">        It is necessary the wd_step and ws_step passed in are at least as</span>
<span class="sd">        large as the current wind direction and wind speed steps.  If they are</span>
<span class="sd">        not, the function will raise an error.</span>

<span class="sd">        The function will return a new WindRose object with the aggregated</span>
<span class="sd">        wind direction and wind speed bins.  If inplace is set to True, the</span>
<span class="sd">        current WindRose object will be updated with the aggregated bins.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step: Step size for wind direction resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            ws_step: Step size for wind speed resampling (float, optional). If</span>
<span class="sd">                None, the current step size will be used. Defaults to None.</span>
<span class="sd">            inplace: Flag indicating whether to update the current WindRose</span>
<span class="sd">                object when True or return a new WindRose object when False</span>
<span class="sd">                (bool, optional). Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: Aggregated wind rose based on the provided or default step</span>
<span class="sd">                sizes. Only returned if inplace = False.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Returns a aggregated version of the wind rose using new `ws_step` and `wd_step`.</span>
<span class="sd">            - Uses the bin weights feature in TimeSeries to aggregated the wind rose.</span>
<span class="sd">            - If `ws_step` or `wd_step` is not specified, it uses the current values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If ws_step is passed in, confirm is it at least as large as the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_ws_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ws_step</span> <span class="o">&lt;</span> <span class="n">current_ws_step</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;ws_step provided must be at least as large as the current ws_step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_ws_step</span><span class="si">}</span><span class="s2"> m/s)&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># If wd_step is passed in, confirm is it at least as large as the current step</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_wd_step</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wd_step</span> <span class="o">&lt;</span> <span class="n">current_wd_step</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;wd_step provided must be at least as large as the current wd_step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_wd_step</span><span class="si">}</span><span class="s2"> degrees)&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># If either ws_step or wd_step is None, set it to the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ws_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind speed, and we assume a ws_step of 1</span>
                <span class="n">ws_step</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind direction, and we assume a wd_step of 1</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Pass the flat versions of each quantity to build a TimeSeries model</span>
        <span class="n">time_series</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ti_table_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Now build a new wind rose using the new steps</span>
        <span class="n">aggregated_wind_rose</span> <span class="o">=</span> <span class="n">time_series</span><span class="o">.</span><span class="n">to_WindRose</span><span class="p">(</span>
            <span class="n">wd_step</span><span class="o">=</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">ws_step</span><span class="p">,</span> <span class="n">bin_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">ti_table</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">value_table</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aggregated_wind_rose</span></div>


<div class="viewcode-block" id="WindRose.resample_by_interpolation">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.resample_by_interpolation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">resample_by_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper to upsample method for backwards compatibility</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">inplace</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.upsample">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.upsample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Resample the wind rose using interpolation for upsampling.  The method can be either</span>
<span class="sd">        &#39;linear&#39; or &#39;nearest&#39;.  If inplace is set to True, the current WindRose</span>
<span class="sd">        object will be updated with the resampled bins.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step: Step size for wind direction resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            ws_step: Step size for wind speed resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            method: Interpolation method to use (str, optional).  Can be either</span>
<span class="sd">                &#39;linear&#39; or &#39;nearest&#39;. Defaults to &quot;linear&quot;.</span>
<span class="sd">            inplace: Flag indicating whether to update the current WindRose</span>
<span class="sd">                object when True or return a new WindRose object when False</span>
<span class="sd">                (bool, optional). Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: Resampled wind rose based on the provided or default step</span>
<span class="sd">                sizes. Only returned if inplace = False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">interpolator</span> <span class="o">=</span> <span class="n">LinearNDInterpolator</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;nearest&quot;</span><span class="p">:</span>
            <span class="n">interpolator</span> <span class="o">=</span> <span class="n">NearestNDInterpolator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown interpolation method: &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="s2">&quot;Available methods are &#39;linear&#39; and &#39;nearest&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># First establish the current ws_step and wd_step</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ws_step_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind speed, and we assume a ws_step of 1</span>
            <span class="n">ws_step_current</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Identify the current step size</span>
            <span class="n">wd_step_current</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind direction, and we assume a wd_step of 1</span>
            <span class="n">wd_step_current</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># If either ws_step or wd_step is None, set it to the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ws_step</span> <span class="o">=</span> <span class="n">ws_step_current</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_step_current</span>

        <span class="c1"># Make sure upsampling is appropriate</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="o">&gt;</span> <span class="n">wd_step_current</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided wd_step (</span><span class="si">{</span><span class="n">wd_step</span><span class="si">}</span><span class="s2">) is larger than the current &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; wind direction step size.  (</span><span class="si">{</span><span class="n">wd_step_current</span><span class="si">}</span><span class="s2"> degrees)&quot;</span>
                <span class="s2">&quot; Use the downsample method.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">ws_step</span> <span class="o">&gt;</span> <span class="n">ws_step_current</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided ws_step (</span><span class="si">{</span><span class="n">ws_step</span><span class="si">}</span><span class="s2">) is larger than &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the current wind speed step size.  (</span><span class="si">{</span><span class="n">ws_step_current</span><span class="si">}</span><span class="s2"> m/s)&quot;</span>
                <span class="s2">&quot; Use the downsample method.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get the current wind directions in adjacent from (ie 0, 2 358 -&gt; -2, 0 ,2)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">current_wind_directions</span><span class="p">,</span> <span class="n">adjacent_sort_index</span> <span class="o">=</span> <span class="n">make_wind_directions_adjacent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_wind_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span>
            <span class="n">adjacent_sort_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">))</span>

        <span class="c1"># Identify the covered range of wind directions</span>
        <span class="n">wd_range_min_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">)</span> <span class="o">-</span> <span class="n">wd_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wd_range_max_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">)</span> <span class="o">+</span> <span class="n">wd_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Look for unlikely case where for example wind directions are 8, 28, ... 358</span>
        <span class="k">if</span> <span class="n">wd_range_max_current</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="c1"># TODO: Handle this case without an error</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot upsample wind rose for case when wind directions are defined&quot;</span>
                <span class="s2">&quot; such that 0 degrees is included by bins to the left of 0 degrees. &quot;</span>
            <span class="p">)</span>

        <span class="c1"># Identify the new minimum wind direction</span>
        <span class="n">wd_min_new</span> <span class="o">=</span> <span class="n">wd_range_min_current</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wd_max_new</span> <span class="o">=</span> <span class="n">wd_range_max_current</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">wd_min_new</span><span class="p">,</span> <span class="n">wd_max_new</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>

        <span class="c1"># Set up the new wind speeds</span>
        <span class="n">ws_range_min_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">-</span> <span class="n">ws_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_range_max_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">+</span> <span class="n">ws_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_min_new</span> <span class="o">=</span> <span class="n">ws_range_min_current</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_max_new</span> <span class="o">=</span> <span class="n">ws_range_max_current</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Force the new ws_min to 0 if negative</span>
        <span class="k">if</span> <span class="n">ws_min_new</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ws_min_new</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">new_wind_speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ws_min_new</span><span class="p">,</span> <span class="n">ws_max_new</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">)</span>

        <span class="c1"># Set up for interpolation by copying the current values</span>
        <span class="c1"># and making sure they are sorted according to the adjacent wind directions</span>
        <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">current_wind_directions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wind_speed_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ti_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">adjacent_sort_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">freq_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">adjacent_sort_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">adjacent_sort_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># For padding wind directions, there are two cases to consider.  In the first,</span>
        <span class="c1"># say that the wind directions are 30, 40, 50.  In this case it&#39;s important append</span>
        <span class="c1"># 30 and 50 to 35 and 55 to ensure the interpolation covers the full range of data</span>
        <span class="c1"># This is the case when wind directions doesn&#39;t cover the full range of possible</span>
        <span class="c1"># degrees (0-360)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">wd_range_min_current</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">wd_range_max_current</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_range_min_current</span><span class="p">]),</span>
                <span class="n">wind_direction_column</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_range_max_current</span><span class="p">])</span>
            <span class="p">))</span>
            <span class="n">ti_matrix</span> <span class="o">=</span> <span class="n">ti_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ti_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">ti_matrix</span><span class="p">,</span> <span class="n">ti_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]))</span>
            <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">freq_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">value_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">value_matrix</span><span class="p">,</span> <span class="n">value_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]))</span>

        <span class="c1"># In the alternative case, where the wind directions cover the full range</span>
        <span class="c1"># ie, 0, 10, 20 30, ...350, then need to place 0 at 360 and 350 at -10</span>
        <span class="c1"># to cover all interpolations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Pad wind direction column with min_wd + 360</span>
            <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">-</span> <span class="mf">360.0</span><span class="p">],</span>
                    <span class="n">wind_direction_column</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Pad the remaining with the appropriate value</span>
            <span class="n">ti_matrix</span> <span class="o">=</span> <span class="n">ti_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ti_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">ti_matrix</span><span class="p">,</span> <span class="n">ti_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">freq_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">value_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">value_matrix</span><span class="p">,</span> <span class="n">value_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>

        <span class="c1"># Pad out the wind speeds</span>
        <span class="n">wind_speed_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ws_range_min_current</span><span class="p">]),</span>
                <span class="n">wind_speed_column</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ws_range_max_current</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ti_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ti_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">ti_matrix</span><span class="p">,</span> <span class="n">ti_matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                    <span class="n">value_matrix</span><span class="p">,</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Grid wind directions and wind speeds to match the ti_matrix and freq_matrix when flattened</span>
        <span class="n">wd_grid</span><span class="p">,</span> <span class="n">ws_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">wind_direction_column</span><span class="p">,</span> <span class="n">wind_speed_column</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>

        <span class="c1"># Form wd_grid and ws_grid to a 2-column matrix</span>
        <span class="n">wd_ws_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Build the interpolator from wd_grid, ws_grid, to ti_matrix, freq_matrix and value_matrix</span>
        <span class="n">ti_interpolator</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">wd_ws_mat</span><span class="p">,</span> <span class="n">ti_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">freq_interpolator</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">wd_ws_mat</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_interpolator</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">wd_ws_mat</span><span class="p">,</span> <span class="n">value_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

        <span class="c1"># Grid the new wind directions and wind speeds</span>
        <span class="n">new_wd_grid</span><span class="p">,</span> <span class="n">new_ws_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">,</span> <span class="n">new_wind_speeds</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
        <span class="n">new_wd_ws_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">new_ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Create the new ti_matrix and freq_matrix</span>
        <span class="n">new_ti_matrix</span> <span class="o">=</span> <span class="n">ti_interpolator</span><span class="p">(</span><span class="n">new_wd_ws_mat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_wind_speeds</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">new_freq_matrix</span> <span class="o">=</span> <span class="n">freq_interpolator</span><span class="p">(</span><span class="n">new_wd_ws_mat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_wind_speeds</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="n">value_interpolator</span><span class="p">(</span><span class="n">new_wd_ws_mat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_wind_speeds</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Wrap new_wind_directions to 0-360</span>
        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">new_wind_directions</span> <span class="o">%</span> <span class="mi">360</span>

        <span class="c1"># Finally sort new_wind_directions, and re-order new_ti_matrix, new_freq_matrix</span>
        <span class="c1"># and new_value_matrix accordingly</span>
        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">)</span>
        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">new_wind_directions</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
        <span class="n">new_ti_matrix</span> <span class="o">=</span> <span class="n">new_ti_matrix</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">new_freq_matrix</span> <span class="o">=</span> <span class="n">new_freq_matrix</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="n">new_value_matrix</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Create the resampled wind rose</span>
        <span class="n">resampled_wind_rose</span> <span class="o">=</span> <span class="n">WindRose</span><span class="p">(</span>
            <span class="n">new_wind_directions</span><span class="p">,</span>
            <span class="n">new_wind_speeds</span><span class="p">,</span>
            <span class="n">new_ti_matrix</span><span class="p">,</span>
            <span class="n">new_freq_matrix</span><span class="p">,</span>
            <span class="n">new_value_matrix</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">ti_table</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">value_table</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resampled_wind_rose</span></div>


<div class="viewcode-block" id="WindRose.plot">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span>
        <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Wind speed [m/s]&quot;</span><span class="p">},</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a wind rose plot showing the frequency of occurrence</span>
<span class="sd">        of the specified wind direction and wind speed bins. If no axis is</span>
<span class="sd">        provided, a new one is created.</span>

<span class="sd">        **Note**: Based on code provided by Patrick Murphy from the University</span>
<span class="sd">        of Colorado Boulder.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the wind rose is plotted. Defaults to None.</span>
<span class="sd">            color_map (str, optional): Colormap to use. Defaults to &#39;viridis_r&#39;.</span>
<span class="sd">            wd_step: Step size for wind direction (float, optional). If None,</span>
<span class="sd">                the current step size will be used. Defaults to None.</span>
<span class="sd">            ws_step: Step size for wind speed (float, optional).</span>
<span class="sd">                the current step size will be used. Defaults to None.</span>
<span class="sd">            legend_kwargs (dict, optional): Keyword arguments to be passed to</span>
<span class="sd">                ax.legend(). Defaults to {&quot;label&quot;: &quot;Wind speed [m/s]&quot;}.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted wind rose.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get a aggregated (downsampled) wind_rose</span>
        <span class="n">wind_rose_aggregate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">wd_bins</span> <span class="o">=</span> <span class="n">wind_rose_aggregate</span><span class="o">.</span><span class="n">wind_directions</span>
        <span class="n">ws_bins</span> <span class="o">=</span> <span class="n">wind_rose_aggregate</span><span class="o">.</span><span class="n">wind_speeds</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">wind_rose_aggregate</span><span class="o">.</span><span class="n">freq_table</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;polar&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="c1"># Get the wd_step</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wd_bins</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wd_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This admittedly an odd edge case</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="mf">360.0</span>

        <span class="c1"># Get a color array</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_bins</span><span class="p">))</span>
        <span class="n">norm_ws</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ws_bins</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ws_bins</span><span class="p">))</span>
        <span class="n">sm_ws</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_ws</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_array</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">wd_idx</span><span class="p">,</span> <span class="n">wd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wd_bins</span><span class="p">):</span>
            <span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">freq_table_sub</span> <span class="o">=</span> <span class="n">freq_table</span><span class="p">[</span><span class="n">wd_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ws_idx</span><span class="p">,</span> <span class="n">ws</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">ws_bins</span><span class="p">))):</span>
                <span class="n">plot_val</span> <span class="o">=</span> <span class="n">freq_table_sub</span><span class="p">[:</span> <span class="n">ws_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span>
                        <span class="n">plot_val</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">wd_step</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">(</span><span class="n">ws_idx</span><span class="p">),</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Configure the plot</span>
        <span class="k">try</span><span class="p">:</span>
           <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm_ws</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
           <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
           <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rects</span><span class="p">),</span> <span class="n">ws_bins</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
           <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_children</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="c1"># Remove the empty colorbar</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_zero_location</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NE&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;SE&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;SW&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;NW&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="WindRose.assign_ti_using_wd_ws_function">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.assign_ti_using_wd_ws_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_ti_using_wd_ws_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the passed in function to assign new values to turbulence_intensities</span>

<span class="sd">        Args:</span>
<span class="sd">            func (function): Function which accepts wind_directions as its</span>
<span class="sd">                first argument and wind_speeds as second argument and returns</span>
<span class="sd">                turbulence_intensities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_gridded_and_flattened_version</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindRose.assign_ti_using_IEC_method">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.assign_ti_using_IEC_method">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_ti_using_IEC_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Iref</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">3.8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define TI as a function of wind speed by specifying an Iref and offset</span>
<span class="sd">        value as in the normal turbulence model in the IEC 61400-1 standard</span>

<span class="sd">        Args:</span>
<span class="sd">            Iref (float): Reference turbulence level, defined as the expected</span>
<span class="sd">                value of TI at 15 m/s. Default = 0.07. Note this value is</span>
<span class="sd">                lower than the values of Iref for turbulence classes A, B, and</span>
<span class="sd">                C in the IEC standard (0.16, 0.14, and 0.12, respectively), but</span>
<span class="sd">                produces TI values more in line with those typically used in</span>
<span class="sd">                FLORIS. When the default Iref and offset are used, the TI at</span>
<span class="sd">                8 m/s is 8.6%.</span>
<span class="sd">            offset (float): Offset value to equation. Default = 3.8, as defined</span>
<span class="sd">                in the IEC standard to give the expected value of TI for</span>
<span class="sd">                each wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Iref</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Iref</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Iref must be &gt;= 0 and &lt;=1&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">iref_func</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">):</span>
            <span class="n">sigma_1</span> <span class="o">=</span> <span class="n">Iref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">wind_speeds</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sigma_1</span> <span class="o">/</span> <span class="n">wind_speeds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_ti_using_wd_ws_function</span><span class="p">(</span><span class="n">iref_func</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.plot_ti_over_ws">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.plot_ti_over_ws">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_ti_over_ws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scatter plot the turbulence_intensities against wind_speeds</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the turbulence intensity is plotted. Defaults to None.</span>
<span class="sd">            marker (str, optional): Scatter plot marker style. Defaults to &quot;.&quot;.</span>
<span class="sd">            ls (str, optional): Scatter plot line style. Defaults to &quot;None&quot;.</span>
<span class="sd">            color (str, optional): Scatter plot color. Defaults to &quot;k&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted turbulence intensities as a function of wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Plot mean and std. devs. of TI in each ws bin in addition to</span>
        <span class="c1"># individual points</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_table_flat</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wind Speed (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Turbulence Intensity (%)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.assign_value_using_wd_ws_function">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.assign_value_using_wd_ws_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_using_wd_ws_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the passed in function to assign new values to the value table.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (function): Function which accepts wind_directions as its</span>
<span class="sd">                first argument and wind_speeds as second argument and returns</span>
<span class="sd">                values.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_gridded_and_flattened_version</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindRose.assign_value_piecewise_linear">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.assign_value_piecewise_linear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_piecewise_linear</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_zero_ws</span><span class="o">=</span><span class="mf">1.425</span><span class="p">,</span>
        <span class="n">ws_knee</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">slope_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">slope_2</span><span class="o">=-</span><span class="mf">0.135</span><span class="p">,</span>
        <span class="n">limit_to_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define value as a continuous piecewise linear function of wind speed</span>
<span class="sd">        with two line segments. The default parameters yield a value function</span>
<span class="sd">        that approximates the normalized mean electricity price vs. wind speed</span>
<span class="sd">        curve for the SPP market in the U.S. for years 2018-2020 from figure 7</span>
<span class="sd">        in Simley et al. &quot;The value of wake steering wind farm flow control in</span>
<span class="sd">        US energy markets,&quot; Wind Energy Science, 2024.</span>
<span class="sd">        https://doi.org/10.5194/wes-9-219-2024. This default value function is</span>
<span class="sd">        constant at low wind speeds, then linearly decreases above 4.5 m/s.</span>

<span class="sd">        Args:</span>
<span class="sd">            value_zero_ws (float, optional): The value when wind speed is zero.</span>
<span class="sd">                Defaults to 1.425.</span>
<span class="sd">            ws_knee (float, optional): The wind speed separating line segments</span>
<span class="sd">                1 and 2. Default = 4.5 m/s.</span>
<span class="sd">            slope_1 (float, optional): The slope of the first line segment</span>
<span class="sd">                (unit of value per m/s). Defaults to zero.</span>
<span class="sd">            slope_2 (float, optional): The slope of the second line segment</span>
<span class="sd">            (unit of value per m/s). Defaults to -0.135.</span>
<span class="sd">            limit_to_zero (bool, optional): If True, negative values will be</span>
<span class="sd">                set to zero. Defaults to False.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">piecewise_linear_value_func</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">slope_1</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">value_zero_ws</span>
            <span class="p">)</span>

            <span class="n">offset_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">slope_1</span> <span class="o">-</span> <span class="n">slope_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ws_knee</span> <span class="o">+</span> <span class="n">value_zero_ws</span>

            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_2</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset_2</span>

            <span class="k">if</span> <span class="n">limit_to_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_value_using_wd_ws_function</span><span class="p">(</span><span class="n">piecewise_linear_value_func</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.plot_value_over_ws">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.plot_value_over_ws">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_value_over_ws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scatter plot the value of the energy generated against wind speed.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the value is plotted. Defaults to None.</span>
<span class="sd">            marker (str, optional): Scatter plot marker style. Defaults to &quot;.&quot;.</span>
<span class="sd">            ls (str, optional): Scatter plot line style. Defaults to &quot;None&quot;.</span>
<span class="sd">            color (str, optional): Scatter plot color. Defaults to &quot;k&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted value as a function of wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Plot mean and std. devs. of value in each ws bin in addition to</span>
        <span class="c1"># individual points</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wind Speed (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRose.read_csv_long">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRose.read_csv_long">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_csv_long</span><span class="p">(</span>
        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ws_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wind_speeds&quot;</span><span class="p">,</span>
        <span class="n">wd_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wind_directions&quot;</span><span class="p">,</span>
        <span class="n">ti_col_or_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;turbulence_intensities&quot;</span><span class="p">,</span>
        <span class="n">freq_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WindRose</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a long-formatted CSV file into the wind rose object. By long, what is meant</span>
<span class="sd">        is that the wind speed, wind direction combination is given for each row in the</span>
<span class="sd">        CSV file. The wind speed, wind direction, are</span>
<span class="sd">        given in separate columns, and the frequency of occurrence of each combination</span>
<span class="sd">        is given in a separate column. The frequency column is optional, and if not</span>
<span class="sd">        provided, uniform frequency of all bins is assumed.</span>

<span class="sd">        The value of ti_col_or_value can be either a string or a float. If it is a string,</span>
<span class="sd">        it is assumed to be the name of the column in the CSV file that contains the</span>
<span class="sd">        turbulence intensity values. If it is a float, it is assumed to be a constant</span>
<span class="sd">        turbulence intensity value for all wind speed and direction combinations.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): Path to the CSV file.</span>
<span class="sd">            ws_col (str): Name of the column in the CSV file that contains the wind speed</span>
<span class="sd">                values. Defaults to &#39;wind_speeds&#39;.</span>
<span class="sd">            wd_col (str): Name of the column in the CSV file that contains the wind direction</span>
<span class="sd">                values. Defaults to &#39;wind_directions&#39;.</span>
<span class="sd">            ti_col_or_value (str or float): Name of the column in the CSV file that contains</span>
<span class="sd">                the turbulence intensity values, or a constant turbulence intensity value.</span>
<span class="sd">            freq_col (str): Name of the column in the CSV file that contains the frequency</span>
<span class="sd">                values. Defaults to None in which case constant frequency assumed.</span>
<span class="sd">            sep (str): Delimiter to use. Defaults to &#39;,&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: Wind rose object created from the CSV file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Read in the CSV file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># If the file cannot be found, then attempt the level above</span>
            <span class="n">base_fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">base_fn</span> <span class="o">/</span> <span class="n">file_path</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>

        <span class="c1"># Check that ti_col_or_value is a string or a float</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ti_col_or_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ti_col_or_value must be a string or a float&quot;</span><span class="p">)</span>

        <span class="c1"># Check that the required columns are present</span>
        <span class="k">if</span> <span class="n">ws_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ws_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wd_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">wd_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ti_col_or_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ti_col_or_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ti_col_or_value</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">freq_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">freq_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">freq_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>

        <span class="c1"># Get the wind speed, wind direction, and turbulence intensity values</span>
        <span class="n">wind_directions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">wd_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ws_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ti_col_or_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ti_col_or_value</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">ti_col_or_value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">freq_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">freq_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">freq_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">))</span>

        <span class="c1"># Normalize freq_values</span>
        <span class="n">freq_values</span> <span class="o">=</span> <span class="n">freq_values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">freq_values</span><span class="p">)</span>

        <span class="c1"># Get the unique values of wind directions and wind speeds</span>
        <span class="n">unique_wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span>
        <span class="n">unique_ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span>

        <span class="c1"># Get the step side for wind direction and wind speed</span>
        <span class="n">wd_step</span> <span class="o">=</span> <span class="n">unique_wd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_wd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ws_step</span> <span class="o">=</span> <span class="n">unique_ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_ws</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Now use TimeSeries to create a wind rose</span>
        <span class="n">time_series</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">turbulence_intensities</span><span class="p">)</span>

        <span class="c1"># Now build a new wind rose using the new steps</span>
        <span class="k">return</span> <span class="n">time_series</span><span class="o">.</span><span class="n">to_WindRose</span><span class="p">(</span><span class="n">wd_step</span><span class="o">=</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">ws_step</span><span class="p">,</span> <span class="n">bin_weights</span><span class="o">=</span><span class="n">freq_values</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="WindTIRose">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WindTIRose</span><span class="p">(</span><span class="n">WindDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WindTIRose is similar to the WindRose class, but contains turbulence</span>
<span class="sd">    intensity as an additional wind rose dimension instead of being defined</span>
<span class="sd">    as a function of wind direction and wind speed. The class is used to drive</span>
<span class="sd">    FLORIS and optimization operations in which the inflow is characterized by</span>
<span class="sd">    the frequency of binned wind speed, wind direction, and turbulence intensity</span>
<span class="sd">    values.</span>

<span class="sd">    Args:</span>
<span class="sd">        wind_directions: NumPy array of wind directions (NDArrayFloat).</span>
<span class="sd">        wind_speeds: NumPy array of wind speeds (NDArrayFloat).</span>
<span class="sd">        turbulence_intensities: NumPy array of turbulence intensities (NDArrayFloat).</span>
<span class="sd">        freq_table: Frequency table for binned wind direction, wind speed, and</span>
<span class="sd">            turbulence intensity values (NDArrayFloat, optional). Must have</span>
<span class="sd">            dimension (n_wind_directions, n_wind_speeds, n_turbulence_intensities).</span>
<span class="sd">            Defaults to None in which case uniform frequency of all bins is</span>
<span class="sd">            assumed.</span>
<span class="sd">        value_table: Value table for binned wind direction, wind</span>
<span class="sd">            speed, and turbulence intensity values (NDArrayFloat, optional).</span>
<span class="sd">            Must have dimension (n_wind_directions, n_wind_speeds,</span>
<span class="sd">            n_turbulence_intensities). Defaults to None in which case uniform</span>
<span class="sd">            values are assumed. Value can be used to weight power in each bin</span>
<span class="sd">            to compute the total value of the energy produced.</span>
<span class="sd">        compute_zero_freq_occurrence: Flag indicating whether to compute zero</span>
<span class="sd">            frequency occurrences (bool, optional).  Defaults to False.</span>
<span class="sd">        heterogeneous_map (HeterogeneousMap, optional): A HeterogeneousMap object to define</span>
<span class="sd">            background heterogeneous inflow condition as a function</span>
<span class="sd">            of wind direction and wind speed.  Alternatively, a dictionary can be</span>
<span class="sd">            passed in to define a HeterogeneousMap object.  Defaults to None.</span>
<span class="sd">        heterogeneous_inflow_config_by_wd (dict, optional): A dictionary containing the following</span>
<span class="sd">            which can be used to define a heterogeneous_map object (note this parameter is kept</span>
<span class="sd">            for backwards compatibility and is not recommended for use):</span>
<span class="sd">            * &#39;x&#39;: A 1D NumPy array (size num_points) of x-coordinates (meters).</span>
<span class="sd">            * &#39;y&#39;: A 1D NumPy array (size num_points) of y-coordinates (meters).</span>
<span class="sd">            * &#39;speed_multipliers&#39;: A 2D NumPy array (size num_wd (or num_ws) x num_points)</span>
<span class="sd">                of speed multipliers.  If neither wind_directions nor wind_speeds are</span>
<span class="sd">                defined, then this should be a single row array</span>
<span class="sd">            * &#39;wind_directions&#39;: A 1D NumPy array (size num_wd) of wind directions (degrees).</span>
<span class="sd">                Optional.</span>
<span class="sd">            * &#39;wind_speeds&#39;: A 1D NumPy array (size num_ws) of wind speeds (m/s). Optional.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wind_directions</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">wind_speeds</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">turbulence_intensities</span><span class="p">:</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">freq_table</span><span class="p">:</span> <span class="n">NDArrayFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value_table</span><span class="p">:</span> <span class="n">NDArrayFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compute_zero_freq_occurrence</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">heterogeneous_map</span><span class="p">:</span> <span class="n">HeterogeneousMap</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_directions must be a NumPy array&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be a NumPy array&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;turbulence_intensities must be a NumPy array&quot;</span><span class="p">)</span>

        <span class="c1"># Confirm that both wind_directions and wind_speeds</span>
        <span class="c1"># and turbulence intensities are monotonically</span>
        <span class="c1"># increasing and evenly spaced</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check monotonically increasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_directions must be monotonically increasing&quot;</span><span class="p">)</span>

            <span class="c1"># Check evenly spaced (Function will raise error if not)</span>
            <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="n">wind_directions</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check monotonically increasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be monotonically increasing&quot;</span><span class="p">)</span>

            <span class="c1"># Check evenly spaced</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">),</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be evenly spaced&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check monotonically increasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;turbulence_intensities must be monotonically increasing&quot;</span><span class="p">)</span>

            <span class="c1"># Check evenly spaced</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">),</span>
                <span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;turbulence_intensities must be evenly spaced&quot;</span><span class="p">)</span>

        <span class="c1"># Save the wind speeds and directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="n">wind_directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">turbulence_intensities</span>

        <span class="c1"># If freq_table is not None, confirm it has correct dimension,</span>
        <span class="c1"># otherwise initialize to uniform probability</span>
        <span class="k">if</span> <span class="n">freq_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_table first dimension must equal len(wind_directions)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;freq_table second dimension must equal len(wind_speeds)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;freq_table third dimension must equal len(turbulence_intensities)&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># Normalize freq table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="p">)</span>

        <span class="c1"># If value_table is not None, confirm it has correct dimension,</span>
        <span class="c1"># otherwise initialize to all ones</span>
        <span class="k">if</span> <span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value_table first dimension must equal len(wind_directions)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value_table second dimension must equal len(wind_speeds)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;value_table third dimension must equal len(turbulence_intensities)&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">=</span> <span class="n">value_table</span>

        <span class="c1"># Save whether zero occurrence cases should be computed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span> <span class="o">=</span> <span class="n">compute_zero_freq_occurrence</span>

        <span class="c1"># Check that heterogeneous_map and heterogeneous_inflow_config_by_wd are not both defined</span>
        <span class="k">if</span> <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of heterogeneous_map and heterogeneous_inflow_config_by_wd can be&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; defined.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If heterogeneous_inflow_config_by_wd is not None, then create a HeterogeneousMap object</span>
        <span class="c1"># using the dictionary</span>
        <span class="k">if</span> <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: In future, add deprectation warning for this parameter here</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">)</span>

        <span class="c1"># Else if heterogeneous_map is not None</span>
        <span class="k">elif</span> <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If heterogeneous_map is a dictionary, then create a HeterogeneousMap object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_map</span><span class="p">)</span>

            <span class="c1"># Else if heterogeneous_map is a HeterogeneousMap object, then save it</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="n">HeterogeneousMap</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">heterogeneous_map</span>

            <span class="c1"># Else raise an error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;heterogeneous_map must be a HeterogeneousMap object or a dictionary.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Else if neither heterogeneous_map nor heterogeneous_inflow_config_by_wd are defined,</span>
        <span class="c1"># then set heterogeneous_map to None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Build the gridded and flatten versions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_gridded_and_flattened_version</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_gridded_and_flattened_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the wind direction, wind speed, and turbulence intensity array,</span>
<span class="sd">        build the gridded versions covering all combinations, and then flatten</span>
<span class="sd">        versions which put all combinations into 1D array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Gridded wind speed and direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Flat wind direction, wind speed, and turbulence intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ti_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Flat frequency table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># value table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set mask to non-zero frequency cases depending on compute_zero_freq_occurrence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">:</span>
            <span class="c1"># If computing zero freq occurrences, then this is all True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

        <span class="c1"># N_findex should only be the calculated cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_findex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">)</span>

<div class="viewcode-block" id="WindTIRose.unpack">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.unpack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack the flattened versions of the matrices and return the values</span>
<span class="sd">        accounting for the non_zero_freq_mask</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The unpacked versions start as the flat version of each</span>
        <span class="n">wind_directions_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wind_speeds_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">turbulence_intensities_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq_table_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Now mask thes values according to self.non_zero_freq_mask</span>
        <span class="n">wind_directions_unpack</span> <span class="o">=</span> <span class="n">wind_directions_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">wind_speeds_unpack</span> <span class="o">=</span> <span class="n">wind_speeds_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">turbulence_intensities_unpack</span> <span class="o">=</span> <span class="n">turbulence_intensities_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>
        <span class="n">freq_table_unpack</span> <span class="o">=</span> <span class="n">freq_table_unpack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span>

        <span class="c1"># Now get unpacked value table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_table_unpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_table_unpack</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If heterogeneous_map is not None, then get the heterogeneous_inflow_config</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="o">.</span><span class="n">get_heterogeneous_inflow_config</span><span class="p">(</span>
                <span class="n">wind_directions</span><span class="o">=</span><span class="n">wind_directions_unpack</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds_unpack</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">wind_directions_unpack</span><span class="p">,</span>
            <span class="n">wind_speeds_unpack</span><span class="p">,</span>
            <span class="n">turbulence_intensities_unpack</span><span class="p">,</span>
            <span class="n">freq_table_unpack</span><span class="p">,</span>
            <span class="n">value_table_unpack</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.aggregate">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.aggregate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for downsample method for backwards compatibility</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">ti_step</span><span class="p">,</span> <span class="n">inplace</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.downsample">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.downsample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregates the wind TI rose into fewer wind direction, wind speed and TI bins.</span>
<span class="sd">        It is necessary the wd_step and ws_step ti_step passed in are at least as</span>
<span class="sd">        large as the current wind direction and wind speed steps.  If they are</span>
<span class="sd">        not, the function will raise an error.</span>

<span class="sd">        The function will return a new WindTIRose object with the aggregated</span>
<span class="sd">        wind direction, wind speed and TI bins.  If inplace is set to True, the</span>
<span class="sd">        current WindTIRose object will be updated with the aggregated bins.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step: Step size for wind direction resampling (float, optional).</span>
<span class="sd">            ws_step: Step size for wind speed resampling (float, optional).</span>
<span class="sd">            ti_step: Step size for turbulence intensity resampling (float, optional).</span>
<span class="sd">            inplace: Flag indicating whether to update the current WindTIRose.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindTIRose: Aggregated wind TI rose based on the provided or default step sizes.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Returns an aggregated version of the wind TI rose using new `ws_step`,</span>
<span class="sd">                `wd_step`, and `ti_step`.</span>
<span class="sd">            - Uses the bin weights feature in TimeSeries to aggregate the wind rose.</span>
<span class="sd">            - If `ws_step`, `wd_step`, or `ti_step` are not specified, it uses</span>
<span class="sd">                the current values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If ws_step is passed in, confirm is it at least as large as the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_ws_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ws_step</span> <span class="o">&lt;</span> <span class="n">current_ws_step</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;ws_step provided must be at least as large as the current ws_step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_ws_step</span><span class="si">}</span><span class="s2"> m/s)&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># If wd_step is passed in, confirm is it at least as large as the current step</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_wd_step</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wd_step</span> <span class="o">&lt;</span> <span class="n">current_wd_step</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;wd_step provided must be at least as large as the current wd_step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_wd_step</span><span class="si">}</span><span class="s2"> degrees)&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># If ti_step is passed in, confirm is it at least as large as the current step</span>
        <span class="k">if</span> <span class="n">ti_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_ti_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ti_step</span> <span class="o">&lt;</span> <span class="n">current_ti_step</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;ti_step provided must be at least as large as the current ti_step &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">current_ti_step</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># If ws_step, wd_step or ti_step is none, set it to the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ws_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind speed, and we assume a ws_step of 1</span>
                <span class="n">ws_step</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind direction, and we assume a wd_step of 1</span>
                <span class="n">wd_step</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">ti_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ti_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single TI, and we assume a ti_step of 1</span>
                <span class="n">ti_step</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Pass the flat versions of each quantity to build a TimeSeries model</span>
        <span class="n">time_series</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ti_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Now build a new wind rose using the new steps</span>
        <span class="n">aggregated_wind_rose</span> <span class="o">=</span> <span class="n">time_series</span><span class="o">.</span><span class="n">to_WindTIRose</span><span class="p">(</span>
            <span class="n">wd_step</span><span class="o">=</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">ws_step</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="n">ti_step</span><span class="p">,</span> <span class="n">bin_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table_flat</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">value_table</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
                <span class="n">aggregated_wind_rose</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aggregated_wind_rose</span></div>


<div class="viewcode-block" id="WindTIRose.resample_by_interpolation">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.resample_by_interpolation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">resample_by_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper to upsample method for backwards compatibility</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">inplace</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.upsample">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.upsample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Resample the wind TI rose using interpolation.  The method can be either</span>
<span class="sd">        &#39;linear&#39; or &#39;nearest&#39;.  If inplace is set to True, the current WindTIRose</span>
<span class="sd">        object will be updated with the resampled bins.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step: Step size for wind direction resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            ws_step: Step size for wind speed resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            ti_step: Step size for turbulence intensity resampling (float, optional).</span>
<span class="sd">                If None, the current step size will be used. Defaults to None.</span>
<span class="sd">            method: Interpolation method to use (str, optional).  Can be either</span>
<span class="sd">                &#39;linear&#39; or &#39;nearest&#39;. Defaults to &quot;linear&quot;.</span>
<span class="sd">            inplace: Flag indicating whether to update the current WindRose</span>
<span class="sd">                object when True or return a new WindRose object when False</span>
<span class="sd">                (bool, optional). Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: Resampled wind rose based on the provided or default step</span>
<span class="sd">                sizes. Only returned if inplace = False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">interpolator</span> <span class="o">=</span> <span class="n">LinearNDInterpolator</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;nearest&quot;</span><span class="p">:</span>
            <span class="n">interpolator</span> <span class="o">=</span> <span class="n">NearestNDInterpolator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown interpolation method: &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="s2">&quot;Available methods are &#39;linear&#39; and &#39;nearest&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># First establish the current ws_step and wd_step and ti_step</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ws_step_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind speed, and we assume a ws_step of 1</span>
            <span class="n">ws_step_current</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">wd_step_current</span> <span class="o">=</span> <span class="n">check_and_identify_step_size</span><span class="p">(</span><span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single wind direction, and we assume a wd_step of 1</span>
            <span class="n">wd_step_current</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ti_step_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind rose will have only a single turbulence intensity,</span>
            <span class="c1"># and we assume a ti_step of 1</span>
            <span class="n">ti_step_current</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># If either ws_step or wd_step or ti_step is None, set it to the current step</span>
        <span class="k">if</span> <span class="n">ws_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ws_step</span> <span class="o">=</span> <span class="n">ws_step_current</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_step_current</span>
        <span class="k">if</span> <span class="n">ti_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ti_step</span> <span class="o">=</span> <span class="n">ti_step_current</span>

        <span class="c1"># Make sure upsampling is appropriate</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="o">&gt;</span> <span class="n">wd_step_current</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided wd_step (</span><span class="si">{</span><span class="n">wd_step</span><span class="si">}</span><span class="s2">) is larger than the current &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; wind direction step size.  (</span><span class="si">{</span><span class="n">wd_step_current</span><span class="si">}</span><span class="s2"> degrees)&quot;</span>
                <span class="s2">&quot; Use the downsample method.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">ws_step</span> <span class="o">&gt;</span> <span class="n">ws_step_current</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided ws_step (</span><span class="si">{</span><span class="n">ws_step</span><span class="si">}</span><span class="s2">) is larger than &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the current wind speed step size.  (</span><span class="si">{</span><span class="n">ws_step_current</span><span class="si">}</span><span class="s2"> m/s)&quot;</span>
                <span class="s2">&quot; Use the downsample method.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">ti_step</span> <span class="o">&gt;</span> <span class="n">ti_step_current</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided ti_step (</span><span class="si">{</span><span class="n">ti_step</span><span class="si">}</span><span class="s2">) is larger than &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the current turbulence intensity step size.  (</span><span class="si">{</span><span class="n">ti_step_current</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="s2">&quot; Use the downsample method.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get the current wind directions in adjacent from (ie 0, 2 358 -&gt; -2, 0 ,2)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">current_wind_directions</span><span class="p">,</span> <span class="n">adjacent_sort_index</span> <span class="o">=</span> <span class="n">make_wind_directions_adjacent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_wind_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span>
            <span class="n">adjacent_sort_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">))</span>

        <span class="c1"># Identify the covered range of wind directions</span>
        <span class="n">wd_range_min_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">)</span> <span class="o">-</span> <span class="n">wd_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wd_range_max_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">current_wind_directions</span><span class="p">)</span> <span class="o">+</span> <span class="n">wd_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Look for unlikely case where for example wind directions are 8, 28, ... 358</span>
        <span class="k">if</span> <span class="n">wd_range_max_current</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="c1"># TODO: Handle this case without an error</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot upsample wind rose for case when wind directions are defined&quot;</span>
                <span class="s2">&quot; such that 0 degrees is included by bins to the left of 0 degrees. &quot;</span>
            <span class="p">)</span>

        <span class="c1"># Identify the new minimum wind direction</span>
        <span class="n">wd_min_new</span> <span class="o">=</span> <span class="n">wd_range_min_current</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wd_max_new</span> <span class="o">=</span> <span class="n">wd_range_max_current</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">wd_min_new</span><span class="p">,</span> <span class="n">wd_max_new</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>

        <span class="c1"># Set up the new wind speeds</span>
        <span class="n">ws_range_min_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">-</span> <span class="n">ws_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_range_max_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">+</span> <span class="n">ws_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_min_new</span> <span class="o">=</span> <span class="n">ws_range_min_current</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ws_max_new</span> <span class="o">=</span> <span class="n">ws_range_max_current</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Force the new ws_min to 0 if negative</span>
        <span class="k">if</span> <span class="n">ws_min_new</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ws_min_new</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">new_wind_speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ws_min_new</span><span class="p">,</span> <span class="n">ws_max_new</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">)</span>

        <span class="c1"># Set up the new turbulence intensities</span>
        <span class="n">ti_range_min_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">-</span> <span class="n">ti_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ti_range_max_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span> <span class="o">+</span> <span class="n">ti_step_current</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ti_min_new</span> <span class="o">=</span> <span class="n">ti_range_min_current</span> <span class="o">+</span> <span class="n">ti_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">ti_max_new</span> <span class="o">=</span> <span class="n">ti_range_max_current</span> <span class="o">-</span> <span class="n">ti_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Force the new ti_min to 0 if negative</span>
        <span class="k">if</span> <span class="n">ti_min_new</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ti_min_new</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">new_turbulence_intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ti_min_new</span><span class="p">,</span> <span class="n">ti_max_new</span> <span class="o">+</span> <span class="n">ti_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">ti_step</span><span class="p">)</span>

        <span class="c1"># Set up for interpolation by copying the current values</span>
        <span class="c1"># and making sure they are sorted according to the adjacent wind directions</span>
        <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">current_wind_directions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wind_speed_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">turbulence_intensity_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">adjacent_sort_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">adjacent_sort_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># For padding wind directions, there are two cases to consider.  In the first,</span>
        <span class="c1"># say that the wind directions are 30, 40, 50.  In this case it&#39;s important append</span>
        <span class="c1"># 30 and 50 to 35 and 55 to ensure the interpolation covers the full range of data</span>
        <span class="c1"># This is the case when wind directions doesn&#39;t cover the full range of possible</span>
        <span class="c1"># degrees (0-360)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">wd_range_min_current</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">wd_range_max_current</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_range_min_current</span><span class="p">]),</span>
                    <span class="n">wind_direction_column</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_range_max_current</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">value_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                        <span class="n">value_matrix</span><span class="p">,</span>
                        <span class="n">value_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>

        <span class="c1"># In the alternative case, where the wind directions cover the full range</span>
        <span class="c1"># ie, 0, 10, 20 30, ...350, then need to place 0 at 360 and 350 at -10</span>
        <span class="c1"># to cover all interpolations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Pad wind direction column with min_wd + 360</span>
            <span class="n">wind_direction_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">-</span> <span class="mf">360.0</span><span class="p">],</span>
                    <span class="n">wind_direction_column</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Pad the remaining with the appropriate value</span>
            <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">value_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                        <span class="n">value_matrix</span><span class="p">,</span>
                        <span class="n">value_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Pad out the wind speeds</span>
        <span class="n">wind_speed_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ws_range_min_current</span><span class="p">]),</span>
                <span class="n">wind_speed_column</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ws_range_max_current</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
                    <span class="n">value_matrix</span><span class="p">,</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

        <span class="c1"># Pad out the turbulence intensities</span>
        <span class="n">turbulence_intensity_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ti_range_min_current</span><span class="p">]),</span>
                <span class="n">turbulence_intensity_column</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ti_range_max_current</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">freq_matrix</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span>
                    <span class="n">value_matrix</span><span class="p">,</span>
                    <span class="n">value_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>

        <span class="c1"># Grid wind directions, wind speeds and turbulence intensities to match the</span>
        <span class="c1"># freq_matrix when flattened</span>
        <span class="n">wd_grid</span><span class="p">,</span> <span class="n">ws_grid</span><span class="p">,</span> <span class="n">ti_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">wind_direction_column</span><span class="p">,</span> <span class="n">wind_speed_column</span><span class="p">,</span> <span class="n">turbulence_intensity_column</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Form wd_grid and ws_grid to a 2-column matrix</span>
        <span class="n">wd_ws_ti_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ti_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Build the interpolator from wd_grid, ws_grid, to ti_matrix, freq_matrix and value_matrix</span>
        <span class="n">freq_interpolator</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">wd_ws_ti_mat</span><span class="p">,</span> <span class="n">freq_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_interpolator</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">wd_ws_ti_mat</span><span class="p">,</span> <span class="n">value_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

        <span class="c1"># Grid the new wind directions and wind speeds</span>
        <span class="n">new_wd_grid</span><span class="p">,</span> <span class="n">new_ws_grid</span><span class="p">,</span> <span class="n">new_ti_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">new_wind_directions</span><span class="p">,</span> <span class="n">new_wind_speeds</span><span class="p">,</span> <span class="n">new_turbulence_intensities</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span>
        <span class="p">)</span>
        <span class="n">new_wd_ws_ti_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">new_wd_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">new_ws_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">new_ti_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Create the new freq_matrix and value_matrix</span>
        <span class="n">new_freq_matrix</span> <span class="o">=</span> <span class="n">freq_interpolator</span><span class="p">(</span><span class="n">new_wd_ws_ti_mat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_wind_speeds</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_turbulence_intensities</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="n">value_interpolator</span><span class="p">(</span><span class="n">new_wd_ws_ti_mat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_wind_speeds</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_turbulence_intensities</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Wrap new_wind_directions to 0-360</span>
        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">new_wind_directions</span> <span class="o">%</span> <span class="mi">360</span>

        <span class="c1"># Finally sort new_wind_directions, and re-order new_ti_matrix, new_freq_matrix</span>
        <span class="c1"># and new_value_matrix accordingly</span>
        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">new_wind_directions</span><span class="p">)</span>
        <span class="n">new_wind_directions</span> <span class="o">=</span> <span class="n">new_wind_directions</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
        <span class="n">new_freq_matrix</span> <span class="o">=</span> <span class="n">new_freq_matrix</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_value_matrix</span> <span class="o">=</span> <span class="n">new_value_matrix</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="c1"># Create the resampled wind rose</span>
        <span class="n">resampled_wind_rose</span> <span class="o">=</span> <span class="n">WindTIRose</span><span class="p">(</span>
            <span class="n">new_wind_directions</span><span class="p">,</span>
            <span class="n">new_wind_speeds</span><span class="p">,</span>
            <span class="n">new_turbulence_intensities</span><span class="p">,</span>
            <span class="n">new_freq_matrix</span><span class="p">,</span>
            <span class="n">new_value_matrix</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">value_table</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
                <span class="n">resampled_wind_rose</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resampled_wind_rose</span></div>


<div class="viewcode-block" id="WindTIRose.plot">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wind_rose_var</span><span class="o">=</span><span class="s2">&quot;ws&quot;</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span>
        <span class="n">wd_step</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
        <span class="n">wind_rose_var_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Wind speed [m/s]&quot;</span><span class="p">},</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a wind rose plot showing the frequency of occurrence</span>
<span class="sd">        of either the specified wind direction and wind speed bins or wind</span>
<span class="sd">        direction and turbulence intensity bins. If no axis is provided, a new</span>
<span class="sd">        one is created.</span>

<span class="sd">        **Note**: Based on code provided by Patrick Murphy from the University</span>
<span class="sd">        of Colorado Boulder.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the wind rose is plotted. Defaults to None.</span>
<span class="sd">            wind_rose_var (str, optional): The variable to display in the wind</span>
<span class="sd">                rose plot in addition to wind direction. If</span>
<span class="sd">                wind_rose_var = &quot;ws&quot;, wind speed frequencies will be plotted.</span>
<span class="sd">                If wind_rose_var = &quot;ti&quot;, turbulence intensity frequencies will</span>
<span class="sd">                be plotted. Defaults to &quot;ws&quot;.</span>
<span class="sd">            color_map (str, optional): Colormap to use. Defaults to &#39;viridis_r&#39;.</span>
<span class="sd">            wd_step (float, optional): Step size for wind direction. Defaults</span>
<span class="sd">                to 15 degrees.</span>
<span class="sd">            wind_rose_var_step (float, optional): Step size for other wind rose</span>
<span class="sd">                variable. Defaults to None. If unspecified, a value of 5 m/s</span>
<span class="sd">                will be used if wind_rose_var = &quot;ws&quot;, and a value of 4% will be</span>
<span class="sd">                used if wind_rose_var = &quot;ti&quot;.</span>
<span class="sd">            legend_kwargs (dict, optional): Keyword arguments to be passed to</span>
<span class="sd">                ax.legend(). Defaults to {&quot;label&quot;: &quot;Wind speed [m/s]&quot;}.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted wind rose.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wind_rose_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;ws&quot;</span><span class="p">,</span> <span class="s2">&quot;ti&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;wind_rose_var must be either &quot;ws&quot; or &quot;ti&quot; for wind speed or turbulence intensity.&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Get a aggregated wind_rose</span>
        <span class="k">if</span> <span class="n">wind_rose_var</span> <span class="o">==</span> <span class="s2">&quot;ws&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wind_rose_var_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wind_rose_var_step</span> <span class="o">=</span> <span class="mf">5.0</span>
            <span class="n">wind_rose_aggregated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">wind_rose_var_step</span><span class="p">)</span>
            <span class="n">var_bins</span> <span class="o">=</span> <span class="n">wind_rose_aggregated</span><span class="o">.</span><span class="n">wind_speeds</span>
            <span class="n">freq_table</span> <span class="o">=</span> <span class="n">wind_rose_aggregated</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># sum along TI dimension</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># wind_rose_var == &quot;ti&quot;</span>
            <span class="k">if</span> <span class="n">wind_rose_var_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wind_rose_var_step</span> <span class="o">=</span> <span class="mf">0.04</span>
            <span class="n">wind_rose_aggregated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="n">wind_rose_var_step</span><span class="p">)</span>
            <span class="n">var_bins</span> <span class="o">=</span> <span class="n">wind_rose_aggregated</span><span class="o">.</span><span class="n">turbulence_intensities</span>
            <span class="n">freq_table</span> <span class="o">=</span> <span class="n">wind_rose_aggregated</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sum along wind speed dimension</span>

        <span class="n">wd_bins</span> <span class="o">=</span> <span class="n">wind_rose_aggregated</span><span class="o">.</span><span class="n">wind_directions</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;polar&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="c1"># Get a color array</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_bins</span><span class="p">))</span>
        <span class="n">norm_wv</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">var_bins</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">var_bins</span><span class="p">))</span>
        <span class="n">sm_wv</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_wv</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_array</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">wd_idx</span><span class="p">,</span> <span class="n">wd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wd_bins</span><span class="p">):</span>
            <span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">freq_table_sub</span> <span class="o">=</span> <span class="n">freq_table</span><span class="p">[</span><span class="n">wd_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">var_idx</span><span class="p">,</span> <span class="n">ws</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">var_bins</span><span class="p">))):</span>
                <span class="n">plot_val</span> <span class="o">=</span> <span class="n">freq_table_sub</span><span class="p">[:</span> <span class="n">var_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span>
                        <span class="n">plot_val</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">wd_step</span><span class="p">),</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">(</span><span class="n">var_idx</span><span class="p">),</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Configure the plot</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm_wv</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rects</span><span class="p">),</span> <span class="n">var_bins</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_children</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="c1"># Remove the empty colorbar</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_theta_zero_location</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NE&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;SE&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;SW&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;NW&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="WindTIRose.plot_ti_over_ws">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.plot_ti_over_ws">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_ti_over_ws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the mean turbulence intensity against wind speed.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the mean turbulence intensity is plotted. Defaults to None.</span>
<span class="sd">            marker (str, optional): Scatter plot marker style. Defaults to &quot;.&quot;.</span>
<span class="sd">            ls (str, optional): Scatter plot line style. Defaults to &quot;None&quot;.</span>
<span class="sd">            color (str, optional): Scatter plot color. Defaults to &quot;k&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted mean turbulence intensities as a function of wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Plot individual points and std. devs. of TI in addition to mean</span>
        <span class="c1"># values</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="c1"># get mean TI for each wind speed by averaging along wind direction and</span>
        <span class="c1"># TI dimensions</span>
        <span class="n">mean_ti_values</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_grid</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">mean_ti_values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wind Speed (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Turbulence Intensity (%)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.assign_value_using_wd_ws_ti_function">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.assign_value_using_wd_ws_ti_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_using_wd_ws_ti_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the passed in function to assign new values to the value table.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (function): Function which accepts wind_directions as its</span>
<span class="sd">                first argument, wind_speeds as its second argument, and</span>
<span class="sd">                turbulence_intensities as its third argument and returns</span>
<span class="sd">                values.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_grid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_table</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_gridded_and_flattened_version</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindTIRose.assign_value_piecewise_linear">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.assign_value_piecewise_linear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_piecewise_linear</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_zero_ws</span><span class="o">=</span><span class="mf">1.425</span><span class="p">,</span>
        <span class="n">ws_knee</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">slope_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">slope_2</span><span class="o">=-</span><span class="mf">0.135</span><span class="p">,</span>
        <span class="n">limit_to_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define value as a continuous piecewise linear function of wind speed</span>
<span class="sd">        with two line segments. The default parameters yield a value function</span>
<span class="sd">        that approximates the normalized mean electricity price vs. wind speed</span>
<span class="sd">        curve for the SPP market in the U.S. for years 2018-2020 from figure 7</span>
<span class="sd">        in Simley et al. &quot;The value of wake steering wind farm flow control in</span>
<span class="sd">        US energy markets,&quot; Wind Energy Science, 2024.</span>
<span class="sd">        https://doi.org/10.5194/wes-9-219-2024. This default value function is</span>
<span class="sd">        constant at low wind speeds, then linearly decreases above 4.5 m/s.</span>

<span class="sd">        Args:</span>
<span class="sd">            value_zero_ws (float, optional): The value when wind speed is zero.</span>
<span class="sd">                Defaults to 1.425.</span>
<span class="sd">            ws_knee (float, optional): The wind speed separating line segments</span>
<span class="sd">                1 and 2. Default = 4.5 m/s.</span>
<span class="sd">            slope_1 (float, optional): The slope of the first line segment</span>
<span class="sd">                (unit of value per m/s). Defaults to zero.</span>
<span class="sd">            slope_2 (float, optional): The slope of the second line segment</span>
<span class="sd">            (unit of value per m/s). Defaults to -0.135.</span>
<span class="sd">            limit_to_zero (bool, optional): If True, negative values will be</span>
<span class="sd">                set to zero. Defaults to False.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">piecewise_linear_value_func</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">turbulence_intensities</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">slope_1</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">value_zero_ws</span>
            <span class="p">)</span>

            <span class="n">offset_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">slope_1</span> <span class="o">-</span> <span class="n">slope_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ws_knee</span> <span class="o">+</span> <span class="n">value_zero_ws</span>

            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_2</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset_2</span>

            <span class="k">if</span> <span class="n">limit_to_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_value_using_wd_ws_ti_function</span><span class="p">(</span><span class="n">piecewise_linear_value_func</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.plot_value_over_ws">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.plot_value_over_ws">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_value_over_ws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scatter plot the value of the energy generated against wind speed.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (:py:class:`matplotlib.pyplot.axes`, optional): The figure axes</span>
<span class="sd">                on which the value is plotted. Defaults to None.</span>
<span class="sd">            marker (str, optional): Scatter plot marker style. Defaults to &quot;.&quot;.</span>
<span class="sd">            ls (str, optional): Scatter plot line style. Defaults to &quot;None&quot;.</span>
<span class="sd">            color (str, optional): Scatter plot color. Defaults to &quot;k&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:class:`matplotlib.pyplot.axes`: A figure axes object containing</span>
<span class="sd">            the plotted value as a function of wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Plot mean and std. devs. of value in each ws bin in addition to</span>
        <span class="c1"># individual points</span>

        <span class="c1"># Set up figure</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_table_flat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wind Speed (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindTIRose.read_csv_long">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindTIRose.read_csv_long">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_csv_long</span><span class="p">(</span>
        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ws_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wind_speeds&quot;</span><span class="p">,</span>
        <span class="n">wd_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wind_directions&quot;</span><span class="p">,</span>
        <span class="n">ti_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;turbulence_intensities&quot;</span><span class="p">,</span>
        <span class="n">freq_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WindTIRose</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a long-formatted CSV file into the WindTIRose object. By long, what is meant</span>
<span class="sd">        is that the wind speed, wind direction  and turbulence intensities</span>
<span class="sd">        combination is given for each row in the</span>
<span class="sd">        CSV file. The wind speed, wind direction, and turbulence intensity are</span>
<span class="sd">        given in separate columns, and the frequency of occurrence of each combination</span>
<span class="sd">        is given in a separate column. The frequency column is optional, and if not</span>
<span class="sd">        provided, uniform frequency of all bins is assumed.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): Path to the CSV file.</span>
<span class="sd">            ws_col (str): Name of the column in the CSV file that contains the wind speed</span>
<span class="sd">                values. Defaults to &#39;wind_speeds&#39;.</span>
<span class="sd">            wd_col (str): Name of the column in the CSV file that contains the wind direction</span>
<span class="sd">                values. Defaults to &#39;wind_directions&#39;.</span>
<span class="sd">            ti_col (str): Name of the column in the CSV file that contains</span>
<span class="sd">                the turbulence intensity values.</span>
<span class="sd">            freq_col (str): Name of the column in the CSV file that contains the frequency</span>
<span class="sd">                values. Defaults to None in which case constant frequency assumed.</span>
<span class="sd">            sep (str): Delimiter to use. Defaults to &#39;,&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: Wind rose object created from the CSV file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Read in the CSV file</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>

        <span class="c1"># Check that the required columns are present</span>
        <span class="k">if</span> <span class="n">ws_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ws_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wd_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">wd_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ti_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ti_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">freq_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">freq_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">freq_col</span><span class="si">}</span><span class="s2"> not found in CSV file&quot;</span><span class="p">)</span>

        <span class="c1"># Get the wind speed, wind direction, and turbulence intensity values</span>
        <span class="n">wind_directions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">wd_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ws_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ti_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">freq_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">freq_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">freq_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">))</span>

        <span class="c1"># Normalize freq_values</span>
        <span class="n">freq_values</span> <span class="o">=</span> <span class="n">freq_values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">freq_values</span><span class="p">)</span>

        <span class="c1"># Get the unique values of wind directions and wind speeds</span>
        <span class="n">unique_wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span>
        <span class="n">unique_ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span>
        <span class="n">unique_ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">)</span>

        <span class="c1"># Get the step side for wind direction and wind speed</span>
        <span class="n">wd_step</span> <span class="o">=</span> <span class="n">unique_wd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_wd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ws_step</span> <span class="o">=</span> <span class="n">unique_ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_ws</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ti_step</span> <span class="o">=</span> <span class="n">unique_ti</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_ti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Now use TimeSeries to create a wind rose</span>
        <span class="n">time_series</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">turbulence_intensities</span><span class="p">)</span>

        <span class="c1"># Now build a new wind rose using the new steps</span>
        <span class="k">return</span> <span class="n">time_series</span><span class="o">.</span><span class="n">to_WindTIRose</span><span class="p">(</span>
            <span class="n">wd_step</span><span class="o">=</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">ws_step</span><span class="p">,</span> <span class="n">ti_step</span><span class="o">=</span><span class="n">ti_step</span><span class="p">,</span> <span class="n">bin_weights</span><span class="o">=</span><span class="n">freq_values</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TimeSeries">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeries</span><span class="p">(</span><span class="n">WindDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The TimeSeries class is used to drive FLORIS and optimization operations in</span>
<span class="sd">    which the inflow is by a sequence of wind direction, wind speed and</span>
<span class="sd">    turbulence intensity values.  Each input of wind direction, wind speed, and</span>
<span class="sd">    turbulence intensity can be assigned as an array of values or a single value.</span>
<span class="sd">    At least one of wind_directions, wind_speeds, or turbulence_intensities must</span>
<span class="sd">    be an array.  If arrays are provided, they must be the same length as the</span>
<span class="sd">    other arrays or the single values.  If single values are provided, then an</span>
<span class="sd">    array of the same length as the other arrays will be created with the single</span>
<span class="sd">    value.</span>

<span class="sd">    Args:</span>
<span class="sd">        wind_directions (float, NDArrayFloat): Wind direction. Can be a single</span>
<span class="sd">            value or an array of values.</span>
<span class="sd">        wind_speeds (float, NDArrayFloat): Wind speed. Can be a single value or</span>
<span class="sd">            an array of values.</span>
<span class="sd">        turbulence_intensities (float, NDArrayFloat): Turbulence intensity. Can be</span>
<span class="sd">            a single value or an array of values.</span>
<span class="sd">        values (NDArrayFloat, optional): Values associated with each wind</span>
<span class="sd">            direction, wind speed, and turbulence intensity. Defaults to None.</span>
<span class="sd">        heterogeneous_map (HeterogeneousMap, optional): A HeterogeneousMap object to define</span>
<span class="sd">            background heterogeneous inflow condition as a function</span>
<span class="sd">            of wind direction and wind speed.  Alternatively, a dictionary can be</span>
<span class="sd">            passed in to define a HeterogeneousMap object.  Defaults to None.</span>
<span class="sd">        heterogeneous_inflow_config_by_wd (dict, optional): A dictionary containing the following</span>
<span class="sd">            which can be used to define a heterogeneous_map object (note this parameter is kept</span>
<span class="sd">            for backwards compatibility and is not recommended for use):</span>
<span class="sd">            * &#39;x&#39;: A 1D NumPy array (size num_points) of x-coordinates (meters).</span>
<span class="sd">            * &#39;y&#39;: A 1D NumPy array (size num_points) of y-coordinates (meters).</span>
<span class="sd">            * &#39;speed_multipliers&#39;: A 2D NumPy array (size num_wd (or num_ws) x num_points)</span>
<span class="sd">                of speed multipliers.  If neither wind_directions nor wind_speeds are</span>
<span class="sd">                defined, then this should be a single row array</span>
<span class="sd">            * &#39;wind_directions&#39;: A 1D NumPy array (size num_wd) of wind directions (degrees).</span>
<span class="sd">                Optional.</span>
<span class="sd">            * &#39;wind_speeds&#39;: A 1D NumPy array (size num_ws) of wind speeds (m/s). Optional.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        heterogeneous_inflow_config (dict, optional): A dictionary containing the following keys.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            * &#39;speed_multipliers&#39;: A 2D NumPy array (size n_findex x num_points)</span>
<span class="sd">                    of speed multipliers.</span>
<span class="sd">            * &#39;x&#39;: A 1D NumPy array (size num_points) of x-coordinates (meters).</span>
<span class="sd">            * &#39;y&#39;: A 1D NumPy array (size num_points) of y-coordinates (meters).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wind_directions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">wind_speeds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">turbulence_intensities</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NDArrayFloat</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">NDArrayFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">heterogeneous_map</span><span class="p">:</span> <span class="n">HeterogeneousMap</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">heterogeneous_inflow_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Check that wind_directions, wind_speeds, and turbulence_intensities are either numpy array</span>
        <span class="c1"># of floats</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_directions must be a float or a NumPy array&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be a float or a NumPy array&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;turbulence_intensities must be a float or a NumPy array&quot;</span><span class="p">)</span>

        <span class="c1"># At least one of wind_directions, wind_speeds, or turbulence_intensities must be an array</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;At least one of wind_directions, wind_speeds, or &quot;</span>
                <span class="s2">&quot; turbulence_intensities must be a NumPy array&quot;</span>
            <span class="p">)</span>

        <span class="c1"># For each of wind_directions, wind_speeds, and turbulence_intensities provided as</span>
        <span class="c1"># an array, confirm they are the same length</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;wind_directions and wind_speeds must be the same length if provided as arrays&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;wind_directions and turbulence_intensities must be &quot;</span>
                    <span class="s2">&quot;the same length if provided as arrays&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;wind_speeds and turbulence_intensities must be the &quot;</span>
                    <span class="s2">&quot;same length if provided as arrays&quot;</span>
                <span class="p">)</span>

        <span class="c1"># For each of wind_directions, wind_speeds, and turbulence_intensities</span>
        <span class="c1"># provided as a single value, set them</span>
        <span class="c1"># to be the same length as those passed in as arrays</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">),</span> <span class="n">wind_directions</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">),</span> <span class="n">wind_directions</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">),</span> <span class="n">wind_speeds</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">),</span> <span class="n">wind_speeds</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">),</span> <span class="n">turbulence_intensities</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">),</span> <span class="n">turbulence_intensities</span><span class="p">)</span>

        <span class="c1"># If values is not None, must be same length as wind_directions/wind_speeds/</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_directions and values must be the same length&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="n">wind_directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">turbulence_intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

        <span class="c1"># Check that at most one of heterogeneous_inflow_config_by_wd,</span>
        <span class="c1"># heterogeneous_map and heterogeneous_inflow_config is not None</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">heterogeneous_inflow_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one of heterogeneous_inflow_config_by_wd, &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;heterogeneous_map, and heterogeneous_inflow_config can be not None.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># if heterogeneous_inflow_config is not None, then the speed_multipliers</span>
        <span class="c1"># must be the same length as wind_directions</span>
        <span class="c1"># in the 0th dimension</span>
        <span class="k">if</span> <span class="n">heterogeneous_inflow_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">heterogeneous_inflow_config</span><span class="p">[</span><span class="s2">&quot;speed_multipliers&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;speed_multipliers must be the same length as wind_directions&quot;</span><span class="p">)</span>

            <span class="c1"># Check  heterogeneous_inflow_config and save</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_heterogeneous_inflow_config</span><span class="p">(</span><span class="n">heterogeneous_inflow_config</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="n">heterogeneous_inflow_config</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If heterogeneous_inflow_config_by_wd is not None, then create a HeterogeneousMap object</span>
        <span class="c1"># using the dictionary</span>
        <span class="k">if</span> <span class="n">heterogeneous_inflow_config_by_wd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: In future, add deprectation warning for this parameter here</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_inflow_config_by_wd</span><span class="p">)</span>

        <span class="c1"># Else if heterogeneous_map is not None</span>
        <span class="k">elif</span> <span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If heterogeneous_map is a dictionary, then create a HeterogeneousMap object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span><span class="o">**</span><span class="n">heterogeneous_map</span><span class="p">)</span>

            <span class="c1"># Else if heterogeneous_map is a HeterogeneousMap object, then save it</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneous_map</span><span class="p">,</span> <span class="n">HeterogeneousMap</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">heterogeneous_map</span>

            <span class="c1"># Else raise an error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;heterogeneous_map must be a HeterogeneousMap object or a dictionary.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Else if neither heterogeneous_map nor heterogeneous_inflow_config_by_wd are defined,</span>
        <span class="c1"># then set heterogeneous_map to None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Record findex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_findex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>

<div class="viewcode-block" id="TimeSeries.unpack">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.unpack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack the time series data in a manner consistent with wind rose unpack</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># to match wind_rose, make a uniform frequency</span>
        <span class="n">uniform_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">)</span>
        <span class="n">uniform_frequency</span> <span class="o">=</span> <span class="n">uniform_frequency</span> <span class="o">/</span> <span class="n">uniform_frequency</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># If heterogeneous_map is not None, then update</span>
        <span class="c1"># heterogeneous_inflow_config to match wind_directions_unpack</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="o">.</span><span class="n">get_heterogeneous_inflow_config</span><span class="p">(</span>
                <span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">heterogeneous_inflow_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_inflow_config</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">,</span>
            <span class="n">uniform_frequency</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_wind_directions_near_360</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_directions</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wraps the wind directions using `wd_step` to produce a wrapped version</span>
<span class="sd">        where values between [360 - wd_step/2.0, 360] get mapped to negative numbers</span>
<span class="sd">        for binning.</span>

<span class="sd">        Args:</span>
<span class="sd">            wind_directions (NDArrayFloat): NumPy array of wind directions.</span>
<span class="sd">            wd_step (float): Step size for wind direction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NDArrayFloat: Wrapped version of wind directions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wind_directions_wrapped</span> <span class="o">=</span> <span class="n">wind_directions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">wind_directions_wrapped</span> <span class="o">&gt;=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wind_directions_wrapped</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_directions_wrapped</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
        <span class="k">return</span> <span class="n">wind_directions_wrapped</span>

<div class="viewcode-block" id="TimeSeries.assign_ti_using_wd_ws_function">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.assign_ti_using_wd_ws_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_ti_using_wd_ws_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the passed in function to new assign values to turbulence_intensities</span>

<span class="sd">        Args:</span>
<span class="sd">            func (function): Function which accepts wind_directions as its</span>
<span class="sd">                first argument and wind_speeds as second argument and returns</span>
<span class="sd">                turbulence_intensities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.assign_ti_using_IEC_method">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.assign_ti_using_IEC_method">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_ti_using_IEC_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Iref</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">3.8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define TI as a function of wind speed by specifying an Iref and offset</span>
<span class="sd">        value as in the normal turbulence model in the IEC 61400-1 standard</span>

<span class="sd">        Args:</span>
<span class="sd">            Iref (float): Reference turbulence level, defined as the expected</span>
<span class="sd">                value of TI at 15 m/s. Default = 0.07. Note this value is</span>
<span class="sd">                lower than the values of Iref for turbulence classes A, B, and</span>
<span class="sd">                C in the IEC standard (0.16, 0.14, and 0.12, respectively), but</span>
<span class="sd">                produces TI values more in line with those typically used in</span>
<span class="sd">                FLORIS. When the default Iref and offset are used, the TI at</span>
<span class="sd">                8 m/s is 8.6%.</span>
<span class="sd">            offset (float): Offset value to equation. Default = 3.8, as defined</span>
<span class="sd">                in the IEC standard to give the expected value of TI for</span>
<span class="sd">                each wind speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Iref</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Iref</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Iref must be &gt;= 0 and &lt;=1&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">iref_func</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">):</span>
            <span class="n">sigma_1</span> <span class="o">=</span> <span class="n">Iref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">wind_speeds</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sigma_1</span> <span class="o">/</span> <span class="n">wind_speeds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_ti_using_wd_ws_function</span><span class="p">(</span><span class="n">iref_func</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.assign_value_using_wd_ws_function">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.assign_value_using_wd_ws_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_using_wd_ws_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the passed in function to assign new values to the value table.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (function): Function which accepts wind_directions as its</span>
<span class="sd">                first argument and wind_speeds as second argument and returns</span>
<span class="sd">                values.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.assign_value_piecewise_linear">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.assign_value_piecewise_linear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_value_piecewise_linear</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_zero_ws</span><span class="o">=</span><span class="mf">1.425</span><span class="p">,</span>
        <span class="n">ws_knee</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">slope_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">slope_2</span><span class="o">=-</span><span class="mf">0.135</span><span class="p">,</span>
        <span class="n">limit_to_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define value as a continuous piecewise linear function of wind speed</span>
<span class="sd">        with two line segments. The default parameters yield a value function</span>
<span class="sd">        that approximates the normalized mean electricity price vs. wind speed</span>
<span class="sd">        curve for the SPP market in the U.S. for years 2018-2020 from figure 7</span>
<span class="sd">        in Simley et al. &quot;The value of wake steering wind farm flow control in</span>
<span class="sd">        US energy markets,&quot; Wind Energy Science, 2024.</span>
<span class="sd">        https://doi.org/10.5194/wes-9-219-2024. This default value function is</span>
<span class="sd">        constant at low wind speeds, then linearly decreases above 4.5 m/s.</span>

<span class="sd">        Args:</span>
<span class="sd">            value_zero_ws (float, optional): The value when wind speed is zero.</span>
<span class="sd">                Defaults to 1.425.</span>
<span class="sd">            ws_knee (float, optional): The wind speed separating line segments</span>
<span class="sd">                1 and 2. Default = 4.5 m/s.</span>
<span class="sd">            slope_1 (float, optional): The slope of the first line segment</span>
<span class="sd">                (unit of value per m/s). Defaults to zero.</span>
<span class="sd">            slope_2 (float, optional): The slope of the second line segment</span>
<span class="sd">            (unit of value per m/s). Defaults to -0.135.</span>
<span class="sd">            limit_to_zero (bool, optional): If True, negative values will be</span>
<span class="sd">                set to zero. Defaults to False.</span>
<span class="sd">            normalize (bool, optional): If True, the value array will be</span>
<span class="sd">                normalized by the mean value. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">piecewise_linear_value_func</span><span class="p">(</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">slope_1</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&lt;</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">value_zero_ws</span>
            <span class="p">)</span>

            <span class="n">offset_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">slope_1</span> <span class="o">-</span> <span class="n">slope_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ws_knee</span> <span class="o">+</span> <span class="n">value_zero_ws</span>

            <span class="n">value</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_2</span> <span class="o">*</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="n">wind_speeds</span> <span class="o">&gt;=</span> <span class="n">ws_knee</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset_2</span>

            <span class="k">if</span> <span class="n">limit_to_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_value_using_wd_ws_function</span><span class="p">(</span><span class="n">piecewise_linear_value_func</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.to_WindRose">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.to_WindRose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_WindRose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wd_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ws_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bin_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the TimeSeries data to a WindRose.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step (float, optional): Step size for wind direction (default is 2.0).</span>
<span class="sd">            ws_step (float, optional): Step size for wind speed (default is 1.0).</span>
<span class="sd">            wd_edges (NDArrayFloat, optional): Custom wind direction edges. Defaults to None.</span>
<span class="sd">            ws_edges (NDArrayFloat, optional): Custom wind speed edges. Defaults to None.</span>
<span class="sd">            bin_weights (NDArrayFloat, optional): Bin weights for resampling.  Note these</span>
<span class="sd">                are primarily used by the downsample() method.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: A WindRose object based on the TimeSeries data.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - If `wd_edges` is defined, it uses it to produce the bin centers.</span>
<span class="sd">            - If `wd_edges` is not defined, it determines `wd_edges` from the step and data.</span>
<span class="sd">            - If `ws_edges` is defined, it uses it for wind speed edges.</span>
<span class="sd">            - If `ws_edges` is not defined, it determines `ws_edges` from the step and data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If wd_edges is defined, then use it to produce the bin centers</span>
        <span class="k">if</span> <span class="n">wd_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wd_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># use wd_step to produce a wrapped version of wind_directions</span>
            <span class="n">wind_directions_wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_wind_directions_near_360</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wd_step</span>
            <span class="p">)</span>

        <span class="c1"># Else, determine wd_edges from the step and data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>

            <span class="c1"># use wd_step to produce a wrapped version of wind_directions</span>
            <span class="n">wind_directions_wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_wind_directions_near_360</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wd_step</span>
            <span class="p">)</span>

            <span class="c1"># Only keep the range with values in it</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="n">wd_edges</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">&gt;</span> <span class="n">wind_directions_wrapped</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="n">wd_edges</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">&lt;=</span> <span class="n">wind_directions_wrapped</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

        <span class="c1"># Define the centers from the edges</span>
        <span class="n">wd_centers</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Repeat for wind speeds</span>
        <span class="k">if</span> <span class="n">ws_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ws_step</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ws_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">)</span>

            <span class="c1"># Only keep the range with values in it</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="n">ws_edges</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="n">ws_edges</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

        <span class="c1"># Define the centers from the edges</span>
        <span class="n">ws_centers</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Now use pandas to get the tables need for wind rose</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;wd&quot;</span><span class="p">:</span> <span class="n">wind_directions_wrapped</span><span class="p">,</span>
                <span class="s2">&quot;ws&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="s2">&quot;freq_val&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions_wrapped</span><span class="p">)),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># If bin_weights are passed in, apply these to the frequency</span>
        <span class="c1"># this is mostly used when resampling the wind rose</span>
        <span class="k">if</span> <span class="n">bin_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">freq_val</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;freq_val&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_weights</span><span class="p">)</span>

        <span class="c1"># Add turbulence intensities to dataframe</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">turbulence_intensities</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">)</span>

        <span class="c1"># If values is not none, add to dataframe</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Bin wind speed and wind direction and then group things up</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">wd_bin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">wd</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">wd_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">wd_centers</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">ws_bin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">ws_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ws_centers</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;wd&quot;</span><span class="p">,</span> <span class="s2">&quot;ws&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Convert wd_bin and ws_bin to categoricals to ensure all combinations</span>
        <span class="c1"># are considered and then group</span>
        <span class="n">wd_cat</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">wd_centers</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ws_cat</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ws_centers</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">wd_bin</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;wd_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">wd_cat</span><span class="p">))</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ws_bin</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ws_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ws_cat</span><span class="p">))</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;wd_bin&quot;</span><span class="p">,</span> <span class="s2">&quot;ws_bin&quot;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># Flatten and combine levels using an underscore</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="c1"># Collect the frequency table and reshape</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;freq_val_sum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span> <span class="o">/</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wd_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_centers</span><span class="p">)))</span>

        <span class="c1"># Compute the TI table</span>
        <span class="n">ti_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;turbulence_intensities_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ti_table</span> <span class="o">=</span> <span class="n">ti_table</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wd_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_centers</span><span class="p">)))</span>

        <span class="c1"># If values is not none, compute the table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;values_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="n">value_table</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wd_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_centers</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Return a WindRose</span>
        <span class="k">return</span> <span class="n">WindRose</span><span class="p">(</span>
            <span class="n">wd_centers</span><span class="p">,</span>
            <span class="n">ws_centers</span><span class="p">,</span>
            <span class="n">ti_table</span><span class="p">,</span>
            <span class="n">freq_table</span><span class="p">,</span>
            <span class="n">value_table</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.to_WindTIRose">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.TimeSeries.to_WindTIRose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_WindTIRose</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wd_step</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">ws_step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">ti_step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
        <span class="n">wd_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ti_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bin_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the TimeSeries data to a WindTIRose.</span>

<span class="sd">        Args:</span>
<span class="sd">            wd_step (float, optional): Step size for wind direction (default is 2.0).</span>
<span class="sd">            ws_step (float, optional): Step size for wind speed (default is 1.0).</span>
<span class="sd">            ti_step (float, optional): Step size for turbulence intensity (default is 0.02).</span>
<span class="sd">            wd_edges (NDArrayFloat, optional): Custom wind direction edges. Defaults to None.</span>
<span class="sd">            ws_edges (NDArrayFloat, optional): Custom wind speed edges. Defaults to None.</span>
<span class="sd">            ti_edges (NDArrayFloat, optional): Custom turbulence intensity</span>
<span class="sd">                edges. Defaults to None.</span>
<span class="sd">            bin_weights (NDArrayFloat, optional): Bin weights for resampling.  Note these</span>
<span class="sd">                are primarily used by the downsample() method.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            WindRose: A WindTIRose object based on the TimeSeries data.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - If `wd_edges` is defined, it uses it to produce the wind direction bin edges.</span>
<span class="sd">            - If `wd_edges` is not defined, it determines `wd_edges` from the step and data.</span>
<span class="sd">            - If `ws_edges` is defined, it uses it for wind speed edges.</span>
<span class="sd">            - If `ws_edges` is not defined, it determines `ws_edges` from the step and data.</span>
<span class="sd">            - If `ti_edges` is defined, it uses it for turbulence intensity edges.</span>
<span class="sd">            - If `ti_edges` is not defined, it determines `ti_edges` from the step and data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If wd_edges is defined, then use it to produce the bin centers</span>
        <span class="k">if</span> <span class="n">wd_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wd_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># use wd_step to produce a wrapped version of wind_directions</span>
            <span class="n">wind_directions_wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_wind_directions_near_360</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wd_step</span>
            <span class="p">)</span>

        <span class="c1"># Else, determine wd_edges from the step and data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>

            <span class="c1"># use wd_step to produce a wrapped version of wind_directions</span>
            <span class="n">wind_directions_wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_wind_directions_near_360</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span> <span class="n">wd_step</span>
            <span class="p">)</span>

            <span class="c1"># Only keep the range with values in it</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="n">wd_edges</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">&gt;</span> <span class="n">wind_directions_wrapped</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
            <span class="n">wd_edges</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[</span><span class="n">wd_edges</span> <span class="o">-</span> <span class="n">wd_step</span> <span class="o">&lt;=</span> <span class="n">wind_directions_wrapped</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

        <span class="c1"># Define the centers from the edges</span>
        <span class="n">wd_centers</span> <span class="o">=</span> <span class="n">wd_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wd_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Repeat for wind speeds</span>
        <span class="k">if</span> <span class="n">ws_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ws_step</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ws_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">ws_step</span><span class="p">)</span>

            <span class="c1"># Only keep the range with values in it</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="n">ws_edges</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
            <span class="n">ws_edges</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[</span><span class="n">ws_edges</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

        <span class="c1"># Define the centers from the edges</span>
        <span class="n">ws_centers</span> <span class="o">=</span> <span class="n">ws_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Repeat for turbulence intensities</span>
        <span class="k">if</span> <span class="n">ti_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ti_step</span> <span class="o">=</span> <span class="n">ti_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ti_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ti_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">ti_step</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ti_step</span><span class="p">)</span>

            <span class="c1"># Only keep the range with values in it</span>
            <span class="n">ti_edges</span> <span class="o">=</span> <span class="n">ti_edges</span><span class="p">[</span><span class="n">ti_edges</span> <span class="o">+</span> <span class="n">ti_step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
            <span class="n">ti_edges</span> <span class="o">=</span> <span class="n">ti_edges</span><span class="p">[</span><span class="n">ti_edges</span> <span class="o">-</span> <span class="n">ti_step</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

        <span class="c1"># Define the centers from the edges</span>
        <span class="n">ti_centers</span> <span class="o">=</span> <span class="n">ti_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ti_step</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Now use pandas to get the tables need for wind rose</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;wd&quot;</span><span class="p">:</span> <span class="n">wind_directions_wrapped</span><span class="p">,</span>
                <span class="s2">&quot;ws&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_intensities</span><span class="p">,</span>
                <span class="s2">&quot;freq_val&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_directions_wrapped</span><span class="p">)),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># If bin_weights are passed in, apply these to the frequency</span>
        <span class="c1"># this is mostly used when resampling the wind rose</span>
        <span class="k">if</span> <span class="n">bin_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">freq_val</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;freq_val&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_weights</span><span class="p">)</span>

        <span class="c1"># If values is not none, add to dataframe</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Bin wind speed, wind direction, and turbulence intensity and then group things up</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">wd_bin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">wd</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">wd_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">wd_centers</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">ws_bin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">ws_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ws_centers</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">ti_bin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">ti</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">ti_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ti_centers</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;wd&quot;</span><span class="p">,</span> <span class="s2">&quot;ws&quot;</span><span class="p">,</span> <span class="s2">&quot;ti&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Convert wd_bin, ws_bin, and ti_bin to categoricals to ensure all</span>
        <span class="c1"># combinations are considered and then group</span>
        <span class="n">wd_cat</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">wd_centers</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ws_cat</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ws_centers</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ti_cat</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ti_centers</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">wd_bin</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;wd_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">wd_cat</span><span class="p">))</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ws_bin</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ws_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ws_cat</span><span class="p">))</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ti_bin</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ti_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ti_cat</span><span class="p">))</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;wd_bin&quot;</span><span class="p">,</span> <span class="s2">&quot;ws_bin&quot;</span><span class="p">,</span> <span class="s2">&quot;ti_bin&quot;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># Flatten and combine levels using an underscore</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="c1"># Collect the frequency table and reshape</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;freq_val_sum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span> <span class="o">/</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wd_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ti_centers</span><span class="p">)))</span>

        <span class="c1"># If values is not none, compute the table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;values_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="n">value_table</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wd_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ti_centers</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Return a WindTIRose</span>
        <span class="k">return</span> <span class="n">WindTIRose</span><span class="p">(</span>
            <span class="n">wd_centers</span><span class="p">,</span>
            <span class="n">ws_centers</span><span class="p">,</span>
            <span class="n">ti_centers</span><span class="p">,</span>
            <span class="n">freq_table</span><span class="p">,</span>
            <span class="n">value_table</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="WindRoseWRG">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WindRoseWRG</span><span class="p">(</span><span class="n">WindDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The WindRoseWRG class is a WindData object the represents a wind resource grid (WRG) file</span>
<span class="sd">    to FLORIS.  As a WindData object it can be passed to the FlorisModel.set method.  A WRG file</span>
<span class="sd">    represents a wind resource as a grid of points where each point has a separate wind rose define</span>
<span class="sd">    by the frequency of each wind direction and the Weibull parameters for each wind direction.</span>

<span class="sd">    WindRoseWRG objects are provided the layout of a wind farm and computes a wind rose at</span>
<span class="sd">    each point in the layout.  The wind rose at each point is computed by interpolating the weibull</span>
<span class="sd">    parameter in the WRG file to the point in the layout and using them to compute a WindRose</span>
<span class="sd">    object.  Each WindRose object shares wind direction and wind speed, only the frequencies differ.</span>

<span class="sd">    When running a FlorisModel with a WindRoseWRG object, most behaviors are the same</span>
<span class="sd">    except functions which compute an expected value, use separate frequencies for each</span>
<span class="sd">    turbine to weight the individual power bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The name of the WRG file to read.</span>
<span class="sd">        wd_step (float, optional): Step size to use resampling the wind directions given by the WRG</span>
<span class="sd">            file. If None, wd_step and wind_directions are set by the number of</span>
<span class="sd">            sectors in the WRG file.   Defaults to None.</span>
<span class="sd">        wind_speeds (NDArrayFloat, optional): Wind speeds to use in the wind rose. Defaults to</span>
<span class="sd">            np.arange(0.0, 26.0, 1.0).</span>
<span class="sd">        ti_table (float, optional): Turbulence intensities table to use for each WindRose object.</span>
<span class="sd">            As in the WindRose ti_table, this can be a single value or an array of values.  If an</span>
<span class="sd">            array of values is provided, it must be (len(wind_directions) x len(wind_speeds)).</span>
<span class="sd">            Defaults to 0.06.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">ti_table</span><span class="o">=</span><span class="mf">0.06</span>
    <span class="p">):</span>
        <span class="c1"># Read in the WRG file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_wrg_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># If wd_step is None, then use the wind directions in the WRG file</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wd_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_step</span>

        <span class="c1"># Initialize the layouts which will need to be specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Save the wind speeds and ti_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span> <span class="o">=</span> <span class="n">ti_table</span>

        <span class="c1"># Initialize the flat arrays, these will depend on the specified wind speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="WindRoseWRG.read_wrg_file">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.read_wrg_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_wrg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the contents of a WRG file and store the data in the object.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): The name of the WRG file to read.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Read the file into data</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># Read the header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

        <span class="c1"># The grid of points is implied by the values above</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span>

        <span class="c1"># The number of grid points (n_gid) is the product of the number of points in x and y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span>

        <span class="c1"># Finally get the number of sectors from the first line after the header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">70</span><span class="p">:</span><span class="mi">72</span><span class="p">])</span>

        <span class="c1"># The wind directions are implied by the number of sectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">)</span>

        <span class="c1"># Initialize the data arrays which have the same number of</span>
        <span class="c1"># elements as the number of grid points</span>
        <span class="n">x_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">)</span>
        <span class="n">y_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">)</span>
        <span class="n">z_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">)</span>
        <span class="n">h_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">)</span>

        <span class="c1"># Initialize the data arrays which are n_gid x n_sectors</span>
        <span class="n">sector_freq_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>
        <span class="n">weibull_A_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>
        <span class="n">weibull_k_gid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>

        <span class="c1"># Loop through the data and extract the values</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gid</span><span class="p">]</span>
            <span class="n">x_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
            <span class="n">y_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>
            <span class="n">z_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">])</span>
            <span class="n">h_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">43</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">):</span>
                <span class="c1"># The frequency of the wind in this sector is in probablility * 1000</span>
                <span class="n">sector_freq_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">,</span> <span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">72</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span> <span class="p">:</span> <span class="mi">76</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1000.0</span>
                <span class="p">)</span>

                <span class="c1"># The A and k parameters are in the next 10 characters, with A stored * 10</span>
                <span class="c1"># and k stored * 100</span>
                <span class="n">weibull_A_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">,</span> <span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">76</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span> <span class="p">:</span> <span class="mi">80</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span><span class="p">])</span> <span class="o">/</span> <span class="mf">10.0</span>
                <span class="n">weibull_k_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">,</span> <span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">80</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span> <span class="p">:</span> <span class="mi">85</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">*</span> <span class="mi">13</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
                <span class="p">)</span>
        <span class="c1"># Save the x_gid and y_gid form for iteration in het map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_gid</span> <span class="o">=</span> <span class="n">x_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_gid</span> <span class="o">=</span> <span class="n">y_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weibull_A_gid</span> <span class="o">=</span> <span class="n">weibull_A_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weibull_k_gid</span> <span class="o">=</span> <span class="n">weibull_k_gid</span>

        <span class="c1"># Save a single value of z and h for the entire grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z_gid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h_gid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Index the by sector data by x and y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sector_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weibull_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weibull_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">x_idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y_idx</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">):</span>
                <span class="c1"># Find the indices when x_gid and y_gid are equal to x and y</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x_gid</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_gid</span> <span class="o">==</span> <span class="n">y</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Assign the data to the correct location</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sector_freq</span><span class="p">[</span><span class="n">x_idx</span><span class="p">,</span> <span class="n">y_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sector_freq_gid</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weibull_A</span><span class="p">[</span><span class="n">x_idx</span><span class="p">,</span> <span class="n">y_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">weibull_A_gid</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weibull_k</span><span class="p">[</span><span class="n">x_idx</span><span class="p">,</span> <span class="n">y_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">weibull_k_gid</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Build the interpolant function lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_sector_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_interpolant_function_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_freq</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_weibull_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_interpolant_function_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weibull_A</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_weibull_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_interpolant_function_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weibull_k</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation of the WindRose object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WindResourceGrid with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2"> grid points, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;min x: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="si">}</span><span class="s2">, min y: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, grid size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;z: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="si">}</span><span class="s2">, h: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="si">}</span><span class="s2"> sectors</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Wind directions in file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Wind directions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Wind speeds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ti_table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_interpolant_function_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_sectors</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a list of interpolant functions for the data.  It is assumed that the function</span>
<span class="sd">        should return a list of interpolant functions, length n_sectors.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (np.array): The x values of the data, length nx.</span>
<span class="sd">            y (np.array): The y values of the data, length ny.</span>
<span class="sd">            n_sectors (int): The number of sectors.</span>
<span class="sd">            data (np.array): The data to interpolate, shape (nx, ny, n_sectors).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of interpolant functions, length n_sectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">function_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sectors</span><span class="p">):</span>
            <span class="n">function_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">RegularGridInterpolator</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">sector</span><span class="p">],</span>
                    <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">function_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">interpolant_function_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate the data at a given x, y location using the interpolant function list.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (float): The x location to interpolate.</span>
<span class="sd">            y (float): The y location to interpolate.</span>
<span class="sd">            interpolant_function_list (list): A list of interpolant functions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of interpolated data, length n_sectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if x and y are within the bounds of the self.x_array and self.y_array, if</span>
        <span class="c1"># so use the nearest method, otherwise use the linear method of interpolation</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolant_function_list</span><span class="p">[</span><span class="n">sector</span><span class="p">]((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_weibull_cumulative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Weibull cumulative distribution function.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (np.array): The wind speed values.</span>
<span class="sd">            a (np.array): The Weibull A parameter values.</span>
<span class="sd">            k (np.array): The Weibull k parameter values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array: The cumulative distribution function values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">exponent</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>

        <span class="c1"># Where x is less than 0, the result should be 0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Original code from PJ Stanley</span>
        <span class="c1"># if x &gt;= 0.0:</span>
        <span class="c1">#     exponent = -(x / a) ** k</span>
        <span class="c1">#     return 1.0 - np.exp(exponent)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     return 0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_wind_speed_frequencies_from_weibull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the wind speed frequencies from the Weibull parameters.  Use the</span>
<span class="sd">        cumulative form of the function and calculate the probability of the wind speed</span>
<span class="sd">        in a given bin via the difference in the cumulative function at the bin edges.</span>
<span class="sd">        Args:</span>

<span class="sd">            A (np.array): The Weibull A parameter.</span>
<span class="sd">            k (np.array): The Weibull k parameter.</span>
<span class="sd">            wind_speeds (np.array): The wind speeds to calculate the frequencies for.</span>
<span class="sd">                If None, the frequencies are calculated for 0 to 25 m/s in 1 m/s increments.</span>
<span class="sd">                Default is None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array: The wind speed frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wind_speeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wind_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span>
        <span class="n">ws_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">ws_steps</span><span class="p">,</span> <span class="n">ws_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
           <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind_speeds must be equally spaced.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ws_step</span> <span class="o">=</span> <span class="n">ws_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Define the wind speed edges (not half-open interval in np.arange)</span>
        <span class="n">wind_speed_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">wind_speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ws_step</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ws_step</span><span class="p">,</span> <span class="n">ws_step</span>
        <span class="p">)</span>

        <span class="c1"># Get the cumulative distribution function at the edges</span>
        <span class="n">cdf_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weibull_cumulative</span><span class="p">(</span><span class="n">wind_speed_edges</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># The frequency is the difference in the cumulative distribution function</span>
        <span class="c1"># at the edges</span>
        <span class="c1"># NOTE: The probability mass associated to each discrete wind speed (ws) is taken as the</span>
        <span class="c1"># cumulative mass under the continuous Weibull distribution from ws - ws_step/2 to</span>
        <span class="c1"># ws + ws_step/2, where ws_step is the step between the provided wind_speeds.</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">cdf_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">cdf_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Normalize the frequency</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">freq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">freq</span>

<div class="viewcode-block" id="WindRoseWRG.get_wind_rose_at_point">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.get_wind_rose_at_point">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_wind_rose_at_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wind_directions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ti_table</span><span class="o">=</span><span class="mf">0.06</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the wind rose at a given x, y location.  Interpolate the parameters to the point</span>
<span class="sd">        and then generate the wind rose.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (float): The x location to interpolate.</span>
<span class="sd">            y (float): The y location to interpolate.</span>
<span class="sd">            wind_directions (np.array): The wind directions to calculate the frequencies for.</span>
<span class="sd">                If None, use self.wind_directions.  Default is None.</span>
<span class="sd">            wind_speeds (np.array): The wind speeds to calculate the frequencies for.</span>
<span class="sd">                If None, use self.wind_speeds.  Default is None.</span>
<span class="sd">            ti_table (float): The ti_table to use in the wind rose.</span>
<span class="sd">                Default is 0.06.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wind_speeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wind_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span>

        <span class="c1"># If wind directions is None, use the values stored</span>
        <span class="k">if</span> <span class="n">wind_directions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wind_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_step</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate wd_step for these directions</span>
            <span class="n">wd_step</span> <span class="o">=</span> <span class="n">wind_directions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wind_directions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get the interpolated data</span>
        <span class="n">sector_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_sector_freq</span><span class="p">)</span>
        <span class="n">weibull_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_weibull_A</span><span class="p">)</span>
        <span class="n">weibull_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolant_weibull_k</span><span class="p">)</span>

        <span class="c1"># Initialize the freq_table</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speeds</span><span class="p">)))</span>

        <span class="c1"># First fill in the rows of the table using the weibull distributions,</span>
        <span class="c1"># weighted by the sector freq</span>
        <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">):</span>
            <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_wind_speed_frequencies_from_weibull</span><span class="p">(</span>
                <span class="n">weibull_A</span><span class="p">[</span><span class="n">sector</span><span class="p">],</span> <span class="n">weibull_k</span><span class="p">[</span><span class="n">sector</span><span class="p">],</span> <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds</span>
            <span class="p">)</span>
            <span class="n">freq_table</span><span class="p">[</span><span class="n">sector</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sector_freq</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span>

        <span class="c1"># Normalize the table</span>
        <span class="n">freq_table</span> <span class="o">=</span> <span class="n">freq_table</span> <span class="o">/</span> <span class="n">freq_table</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># First build the wind rose using the wind directions in the wrg file</span>
        <span class="n">wind_rose</span> <span class="o">=</span> <span class="n">WindRose</span><span class="p">(</span>
            <span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">,</span>
            <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds</span><span class="p">,</span>
            <span class="n">freq_table</span><span class="o">=</span><span class="n">freq_table</span><span class="p">,</span>
            <span class="n">ti_table</span><span class="o">=</span><span class="n">ti_table</span><span class="p">,</span>
            <span class="n">compute_zero_freq_occurrence</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Now upsample or downsample the wind rose to the specified wind directions</span>
        <span class="k">if</span> <span class="n">wd_step</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># If the wind directions are the same, return the wind rose</span>
            <span class="k">return</span> <span class="n">wind_rose</span>
        <span class="k">elif</span> <span class="n">wd_step</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># If the wind directions are smaller, upsample</span>
            <span class="k">return</span> <span class="n">wind_rose</span><span class="o">.</span><span class="n">upsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the wind directions are larger, downsample</span>
            <span class="k">return</span> <span class="n">wind_rose</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">wd_step</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRoseWRG.set_wd_step">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.set_wd_step">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_wd_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the wind directions for the WindRoseWRG object.</span>

<span class="sd">        Args:</span>
<span class="sd">            wind_directions (np.array): The wind directions to use for the wind roses.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">wd_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_step</span> <span class="o">=</span> <span class="n">wd_step</span>

        <span class="c1"># Update the wind roses if the layout has been set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_wind_roses</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindRoseWRG.set_wind_speeds">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.set_wind_speeds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_wind_speeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the wind speeds for the WindRoseWRG object.</span>

<span class="sd">        Args:</span>
<span class="sd">            wind_speeds (np.array): The wind speeds to use for the wind roses.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds</span>

        <span class="c1"># Update the wind roses if the layout has been set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_wind_roses</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindRoseWRG.set_ti_table">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.set_ti_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_ti_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ti_table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the fixed turbulence intensity value for the WindRoseWRG object.</span>

<span class="sd">        Args:</span>
<span class="sd">            ti_table (float): The ti_table value to use in the wind roses.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span> <span class="o">=</span> <span class="n">ti_table</span>

        <span class="c1"># Update the wind roses if the layout has been set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_wind_roses</span><span class="p">()</span></div>


<div class="viewcode-block" id="WindRoseWRG.set_layout">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.set_layout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_x</span><span class="p">,</span> <span class="n">layout_y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the layout for the WindRoseWRG object.</span>

<span class="sd">        Args:</span>
<span class="sd">            layout_x (np.array): The x coordinates of the layout.</span>
<span class="sd">            layout_y (np.array): The y coordinates of the layout.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Confirm that layout_x, layout_y, and wind_roses are the same length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">layout_x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layout_y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;layout_x and layout_y must be the same length&quot;</span><span class="p">)</span>

        <span class="c1"># If the current layout is the same as the new layout, return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">layout_x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">layout_y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span>
            <span class="p">):</span>
                <span class="k">return</span>

        <span class="c1"># Save the layouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">layout_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">layout_y</span><span class="p">)</span>

        <span class="c1"># Update the wind roses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_wind_roses</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_wind_roses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize the list of wind roses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Loop through the turbines and get the wind rose at each location</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span><span class="p">)):</span>
            <span class="n">wind_rose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wind_rose_at_point</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
                <span class="n">wind_speeds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">ti_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_table</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wind_rose</span><span class="p">)</span>

        <span class="c1"># Save also the wd_flat and ws_flat from the first wind rose as this could be needed</span>
        <span class="c1"># for unpacking and non_zero_freq_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">wd_flat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ws_flat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_zero_freq_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">non_zero_freq_mask</span>

<div class="viewcode-block" id="WindRoseWRG.unpack">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.unpack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the unpack method for WindRoseByTurbine by</span>
<span class="sd">        calling the unpack method for each of the WindRose objects in wind_roses.</span>
<span class="sd">        Mose of the variables can be passed as is but freq_table_unpack are combined</span>
<span class="sd">        and stacked along the 1th axis</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple: Tuple containing the unpacked wind rose data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;WindRoseByTurbine must be initialized to a layout before unpacking&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize freq_table_unpack</span>
        <span class="n">freq_table_unpack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_flat</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span><span class="p">)))</span>

        <span class="c1"># Loop over remaining wind roses and stack freq_table_unpack</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">wind_rose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">):</span>
            <span class="p">(</span>
                <span class="n">wind_directions_unpack</span><span class="p">,</span>
                <span class="n">wind_speeds_unpack</span><span class="p">,</span>
                <span class="n">ti_table_unpack</span><span class="p">,</span>
                <span class="n">freq_table_unpack_0</span><span class="p">,</span>
                <span class="n">value_table_unpack</span><span class="p">,</span>
                <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">wind_rose</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
            <span class="n">freq_table_unpack</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_table_unpack_0</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">wind_directions_unpack</span><span class="p">,</span>
            <span class="n">wind_speeds_unpack</span><span class="p">,</span>
            <span class="n">ti_table_unpack</span><span class="p">,</span>
            <span class="n">freq_table_unpack</span><span class="p">,</span>
            <span class="n">value_table_unpack</span><span class="p">,</span>
            <span class="n">heterogeneous_inflow_config</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WindRoseWRG.plot_wind_roses">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.plot_wind_roses">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_wind_roses</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">axarr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wd_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the wind roses for each turbine in the WindRoseByTurbine object.</span>

<span class="sd">        Args:</span>
<span class="sd">            axarr (NDArrayAxes, optional): Array of axes to plot the wind roses on.</span>
<span class="sd">                Defaults to None.  Must have length equal to the number of wind roses.</span>
<span class="sd">            wd_step (float, optional): Step size for wind direction. Defaults to None.</span>
<span class="sd">            ws_step (float, optional): Step size for wind speed. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;WindRoseByTurbine must be initialized to a layout before plotting&quot;</span><span class="p">)</span>

        <span class="c1"># If axarr is not defined, create a new figure</span>
        <span class="k">if</span> <span class="n">axarr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;polar&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="c1"># Test that axarr is the correct length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axarr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axarr must have the same length as the number of wind roses&quot;</span><span class="p">)</span>

        <span class="c1"># Plot the wind roses for each turbine</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">wind_rose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_roses</span><span class="p">):</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">wd_step</span><span class="o">=</span><span class="n">wd_step</span><span class="p">,</span> <span class="n">ws_step</span><span class="o">=</span><span class="n">ws_step</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Turbine </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WindRoseWRG.get_heterogeneous_wind_rose">
<a class="viewcode-back" href="../../_autosummary/floris.wind_data.html#floris.wind_data.WindRoseWRG.get_heterogeneous_wind_rose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_heterogeneous_wind_rose</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fmodel</span><span class="p">,</span>
        <span class="n">wind_speeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">representative_wind_speed</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the heterogeneous map at each location in the grid, with the speeds ups</span>
<span class="sd">        defined relative the location indicated by gid_norm_index.</span>

<span class="sd">        Args:</span>
<span class="sd">            fmodel (FlorisModel): The FlorisModel object to use to generate the power curve.</span>
<span class="sd">            wind_speeds (np.array): The wind speeds to calculate the frequencies for.</span>
<span class="sd">                Default is np.arange(0.0, 25.0, 1.0).</span>
<span class="sd">            gid_norm_index (int): The index of the turbine to normalize the speed ups to.</span>
<span class="sd">                Default is 0.</span>
<span class="sd">            representative_wind_speed (float): The representative wind speed to use</span>
<span class="sd">                in the power curve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            HeterogeneousMap: The heterogeneous map object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">############################</span>
        <span class="c1"># Compute the power curve for combining the wind speeds</span>
        <span class="c1">############################</span>

        <span class="k">if</span> <span class="n">wind_speeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wind_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speeds</span>

        <span class="c1"># Get a local copy</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fmodel</span><span class="p">)</span>

        <span class="c1"># Get the power curve for the turbine</span>
        <span class="c1"># TODO: Maybe the power curve could be directly extracted</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">layout_x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">layout_y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">wind_data</span><span class="o">=</span><span class="n">TimeSeries</span><span class="p">(</span>
                <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="n">wind_directions</span><span class="o">=</span><span class="mf">270.0</span><span class="p">,</span>
                <span class="n">turbulence_intensities</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">turbine_power</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">get_turbine_powers</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1">############################</span>
        <span class="c1"># Identify the point on the original wrg grid closest to the x_loc and y_loc</span>
        <span class="c1">############################</span>

        <span class="k">if</span> <span class="n">x_loc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y_loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Simply use the first point</span>
            <span class="n">gid_reference</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Find the closest point</span>
            <span class="n">gid_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_gid</span> <span class="o">-</span> <span class="n">x_loc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gid</span> <span class="o">-</span> <span class="n">y_loc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Assign x_loc and y_loc to this point</span>
        <span class="n">x_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_gid</span><span class="p">[</span><span class="n">gid_reference</span><span class="p">]</span>
        <span class="n">y_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_gid</span><span class="p">[</span><span class="n">gid_reference</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using point </span><span class="si">{</span><span class="n">gid_reference</span><span class="si">}</span><span class="s2"> at (</span><span class="si">{</span><span class="n">x_loc</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_loc</span><span class="si">}</span><span class="s2">) as reference location&quot;</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># Get the wind rose at this point</span>
        <span class="c1">############################</span>
        <span class="n">wind_rose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wind_rose_at_point</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_loc</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y_loc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Subset to the representative wind speed</span>

        <span class="c1"># Check the represenative_wind_speed is valid</span>
        <span class="k">if</span> <span class="n">representative_wind_speed</span> <span class="ow">in</span> <span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">:</span>
            <span class="n">ws_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span> <span class="o">==</span> <span class="n">representative_wind_speed</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;representative_wind_speed must be in original set&quot;</span><span class="p">)</span>

        <span class="c1"># Create a new wind rose with only the specified wind speeds</span>
        <span class="n">wind_rose</span> <span class="o">=</span> <span class="n">WindRose</span><span class="p">(</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">[</span><span class="n">ws_idx</span><span class="p">],</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">ti_table</span><span class="p">[:,</span> <span class="n">ws_idx</span><span class="p">],</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">[:,</span> <span class="n">ws_idx</span><span class="p">],</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">value_table</span><span class="p">[:,</span> <span class="n">ws_idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">wind_rose</span><span class="o">.</span><span class="n">value_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">compute_zero_freq_occurrence</span><span class="p">,</span>
            <span class="n">wind_rose</span><span class="o">.</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># Calculate speed multipliers</span>
        <span class="c1">############################</span>

        <span class="n">speed_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">direction_sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sectors</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gid</span><span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_wind_speed_frequencies_from_weibull</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">weibull_A_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">,</span> <span class="n">direction_sector</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">weibull_k_gid</span><span class="p">[</span><span class="n">gid</span><span class="p">,</span> <span class="n">direction_sector</span><span class="p">],</span>
                    <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_speeds</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Record the expected power</span>
                <span class="n">speed_multipliers</span><span class="p">[</span><span class="n">direction_sector</span><span class="p">,</span> <span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">turbine_power</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>

            <span class="c1"># Normalize the speed ups</span>
            <span class="n">speed_multipliers</span><span class="p">[</span><span class="n">direction_sector</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">speed_multipliers</span><span class="p">[</span><span class="n">direction_sector</span><span class="p">,</span> <span class="p">:]</span>
                <span class="o">/</span> <span class="n">speed_multipliers</span><span class="p">[</span><span class="n">direction_sector</span><span class="p">,</span> <span class="n">gid_reference</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Take the cube root of the speed ups to place in the frame of wind speed ups</span>
        <span class="n">speed_multipliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">speed_multipliers</span><span class="p">)</span>

        <span class="c1"># Create the heterogeneous map</span>
        <span class="n">heterogeneous_map</span> <span class="o">=</span> <span class="n">HeterogeneousMap</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_gid</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gid</span><span class="p">,</span>
            <span class="n">wind_directions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wind_directions_wrg_file</span><span class="p">,</span>
            <span class="n">speed_multipliers</span><span class="o">=</span><span class="n">speed_multipliers</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Return the wind rose with the heterogeneous map</span>
        <span class="k">return</span> <span class="n">WindRose</span><span class="p">(</span>
            <span class="n">wind_directions</span><span class="o">=</span><span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_directions</span><span class="p">,</span>
            <span class="n">wind_speeds</span><span class="o">=</span><span class="n">wind_rose</span><span class="o">.</span><span class="n">wind_speeds</span><span class="p">,</span>
            <span class="n">freq_table</span><span class="o">=</span><span class="n">wind_rose</span><span class="o">.</span><span class="n">freq_table</span><span class="p">,</span>
            <span class="n">ti_table</span><span class="o">=</span><span class="n">wind_rose</span><span class="o">.</span><span class="n">ti_table</span><span class="p">,</span>
            <span class="n">heterogeneous_map</span><span class="o">=</span><span class="n">heterogeneous_map</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By National Renewable Energy Laboratory
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>